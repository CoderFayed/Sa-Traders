<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SA Traders - হিসাব ব্যবস্থাপনা</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* প্রাকৃতিক সিনারি ব্যাকগ্রাউন্ড স্টাইল */
        .login-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
        }
        
        .nature-scene {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, 
                #1a2980 0%, 
                #26d0ce 100%);
        }
        
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: float 60s infinite linear;
        }
        
        .cloud:nth-child(1) {
            width: 200px;
            height: 60px;
            top: 10%;
            left: -200px;
            animation-delay: 0s;
        }
        
        .cloud:nth-child(2) {
            width: 150px;
            height: 45px;
            top: 25%;
            left: -150px;
            animation-delay: 10s;
        }
        
        .cloud:nth-child(3) {
            width: 180px;
            height: 55px;
            top: 40%;
            left: -180px;
            animation-delay: 20s;
        }
        
        .cloud:nth-child(4) {
            width: 120px;
            height: 40px;
            top: 60%;
            left: -120px;
            animation-delay: 30s;
        }
        
        .cloud:nth-child(5) {
            width: 160px;
            height: 50px;
            top: 75%;
            left: -160px;
            animation-delay: 40s;
        }
        
        .bird {
            position: absolute;
            width: 30px;
            height: 20px;
            background: #333;
            clip-path: polygon(0% 50%, 100% 0%, 100% 100%);
            animation: fly 30s infinite linear;
        }
        
        .bird:nth-child(6) {
            top: 20%;
            animation-delay: 0s;
        }
        
        .bird:nth-child(7) {
            top: 35%;
            animation-delay: 5s;
        }
        
        .bird:nth-child(8) {
            top: 50%;
            animation-delay: 10s;
        }
        
        .sun {
            position: absolute;
            width: 100px;
            height: 100px;
            background: #ffdd40;
            border-radius: 50%;
            top: 50px;
            right: 100px;
            box-shadow: 0 0 50px #ffdd40;
        }
        
        .tree {
            position: absolute;
            bottom: 0;
            background: #228B22;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        
        .tree:nth-child(9) {
            width: 100px;
            height: 150px;
            left: 10%;
        }
        
        .tree:nth-child(10) {
            width: 80px;
            height: 120px;
            left: 30%;
        }
        
        .tree:nth-child(11) {
            width: 120px;
            height: 180px;
            right: 20%;
        }
        
        .tree:nth-child(12) {
            width: 90px;
            height: 140px;
            right: 40%;
        }
        
        @keyframes float {
            0% {
                transform: translateX(0) translateY(0);
            }
            25% {
                transform: translateX(calc(100vw + 200px)) translateY(-20px);
            }
            50% {
                transform: translateX(calc(100vw + 200px)) translateY(20px);
            }
            75% {
                transform: translateX(0) translateY(-10px);
            }
            100% {
                transform: translateX(0) translateY(0);
            }
        }
        
        @keyframes fly {
            0% {
                transform: translateX(0) translateY(0);
            }
            25% {
                transform: translateX(calc(100vw + 50px)) translateY(-15px);
            }
            50% {
                transform: translateX(calc(100vw + 50px)) translateY(10px);
            }
            75% {
                transform: translateX(0) translateY(-5px);
            }
            100% {
                transform: translateX(0) translateY(0);
            }
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            font-size: 28px;
            font-weight: bold;
        }
        
        .contact-info {
            text-align: right;
            font-size: 14px;
        }
        
        .login-container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            margin: 100px auto;
            position: relative;
            z-index: 100;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .login-container h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #2a5298;
            font-size: 28px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 25px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2a5298;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: all 0.3s ease;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #2a5298, #1e3c72);
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .dashboard {
            display: none;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: initial;
            margin-bottom: 20px;
            gap: 15px;
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .card h3 {
            margin-bottom: 15px;
            color: #2a5298;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        table th, table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-info {
            background: #17a2b8;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .customer-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .transaction-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .product-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .purchase-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .commission-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .statement-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .statement-options select, .statement-options input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            flex: 1;
            min-width: 150px;
        }
        
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .logout-btn:hover {
            background: #c82333;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .delete-btn:hover {
            background: #c82333;
        }
        
        .edit-btn {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .edit-btn:hover {
            background: #e0a800;
        }
        
        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .success-message {
            color: #28a745;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .amount-display {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-weight: bold;
            text-align: center;
        }
        
        .payment-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .stock-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .commission-info {
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-weight: bold;
            text-align: center;
        }

        .stock-low {
            color: #dc3545;
            font-weight: bold;
        }
        
        .stock-medium {
            color: #ffc107;
            font-weight: bold;
        }
        
        .stock-high {
            color: #28a745;
            font-weight: bold;
        }

        .profit-positive {
            color: #28a745;
            font-weight: bold;
        }
        
        .profit-negative {
            color: #dc3545;
            font-weight: bold;
        }
        
        .profit-neutral {
            color: #6c757d;
            font-weight: bold;
        }

        /* প্রিন্ট স্টাইল */
        @media print {
            body * {
                visibility: hidden;
            }
            .print-section, .print-section * {
                visibility: visible;
            }
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
            }
            .no-print {
                display: none !important;
            }
            .excel-table {
                border-collapse: collapse;
                width: 100%;
                font-size: 12px;
            }
            .excel-table th, .excel-table td {
                border: 1px solid #000;
                padding: 6px 8px;
                text-align: left;
            }
            .excel-table th {
                background-color: #f2f2f2;
                font-weight: bold;
            }
            .summary-box {
                border: 1px solid #000;
                padding: 10px;
                margin-top: 15px;
                background-color: #f9f9f9;
            }
            
            /* প্রিন্ট হেডার স্টাইল - কালার সহ */
            .print-header {
                background: linear-gradient(135deg, #1e3c72, #2a5298) !important;
                color: white !important;
                padding: 25px;
                text-align: center;
                border-radius: 12px;
                margin-bottom: 25px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                border: 2px solid #1e3c72;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .print-header .logo {
                font-size: 32px;
                font-weight: bold;
                margin-bottom: 10px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                color: white !important;
            }
            
            .print-header .tagline {
                font-size: 18px;
                font-weight: 500;
                margin-bottom: 15px;
                opacity: 0.9;
                color: white !important;
            }
            
            .print-header .contact-info {
                display: flex;
                justify-content: center;
                gap: 30px;
                font-size: 14px;
                margin-top: 10px;
                color: white !important;
            }
            
            .print-header .contact-item {
                display: flex;
                align-items: center;
                gap: 8px;
                color: white !important;
            }
            
            .print-header .contact-item i {
                font-size: 16px;
                color: white !important;
            }
        }

        /* এক্সেল স্টাইল টেবিল */
        .excel-table {
            border-collapse: collapse;
            width: 100%;
            font-size: 14px;
            margin-top: 15px;
        }
        .excel-table th, .excel-table td {
            border: 1px solid #ddd;
            padding: 8px 10px;
            text-align: left;
        }
        .excel-table th {
            background-color: #f2f2f2;
            font-weight: bold;
            color: #333;
        }
        .excel-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .summary-box {
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .summary-box h4 {
            margin-bottom: 10px;
            color: #2a5298;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            padding: 5px 0;
            border-bottom: 1px dashed #ddd;
        }
        .summary-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 16px;
        }
        
        /* প্রিন্ট হেডার স্টাইল (স্ক্রিনের জন্য) */
        .print-header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 25px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 2px solid #1e3c72;
        }
        
        .print-header .logo {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .print-header .tagline {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .print-header .contact-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .print-header .contact-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .print-header .contact-item i {
            font-size: 16px;
        }
        
        /* প্রিন্ট এবং ডাউনলোড স্টাইল */
        .print-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .print-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .print-btn:hover {
            background: #0056b3;
        }
        
        .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .download-btn:hover {
            background: #1e7e34;
        }
        
        .statement-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        /* পেমেন্ট ব্যবস্থাপনা স্টাইল */
        .payment-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        
        .payment-form .form-group {
            margin-bottom: 15px;
        }
        
        .payment-form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
        }
        
        .payment-record {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .payment-record.supplier {
            border-left: 4px solid #28a745;
        }
        
        .payment-record.customer {
            border-left: 4px solid #17a2b8;
        }
        
        .payment-method {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 5px;
        }
        
        .payment-cash {
            background: #28a745;
            color: white;
        }
        
        .payment-bank {
            background: #007bff;
            color: white;
        }
        
        .payment-bkash {
            background: #e2136e;
            color: white;
        }
        
        .payment-nagad {
            background: #eb0029;
            color: white;
        }
        
        .payment-check {
            background: #6f42c1;
            color: white;
        }
        
        .due-summary-card {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
        }
        
        .due-summary-card.supplier {
            border-top: 4px solid #28a745;
        }
        
        .due-summary-card.customer {
            border-top: 4px solid #17a2b8;
        }
        
        .due-amount {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .due-positive {
            color: #28a745;
        }
        
        .due-negative {
            color: #dc3545;
        }
        
        .supplier-list, .customer-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .supplier-item, .customer-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .supplier-item:hover, .customer-item:hover {
            background: #f8f9fa;
        }
        
        .supplier-item.selected, .customer-item.selected {
            background: #e8f4ff;
            border-left: 3px solid #007bff;
        }
        
        .supplier-name {
            font-weight: bold;
            color: #333;
        }
        
        .supplier-due {
            float: right;
            font-weight: bold;
        }
        
        .customer-name {
            font-weight: bold;
            color: #333;
        }
        
        .customer-due {
            float: right;
            font-weight: bold;
        }
        
        .payment-details {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .deposit-form {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #e9ecef;
        }
        
        .deposit-record {
            background: #e8f5e9;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #4caf50;
        }
        
        /* অটোকমপ্লিট স্টাইল */
        .autocomplete-container {
            position: relative;
        }
        
        .clear-input {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #999;
            font-size: 18px;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .clear-input:hover {
            color: #dc3545;
        }
        
        .datalist-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .datalist-option {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        
        .datalist-option:hover {
            background: #f8f9fa;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .dashboard-header {
                flex-direction: column;
            }
            
            .contact-info {
                margin-top: 10px;
                text-align: center;
            }
            
            .customer-form, .transaction-form, .product-form, .purchase-form, .commission-form {
                grid-template-columns: 1fr;
            }
            
            .statement-options {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .excel-table {
                font-size: 12px;
            }
            
            .excel-table th, .excel-table td {
                padding: 4px 6px;
            }
            
            .print-header .contact-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .print-header {
                padding: 20px 15px;
            }
            
            .print-header .logo {
                font-size: 24px;
            }
            
            .print-header .tagline {
                font-size: 16px;
            }
            
            .print-actions, .statement-actions {
                flex-direction: column;
            }
            
            .login-container {
                margin: 50px auto;
                padding: 30px 20px;
            }
            
            .autocomplete-container .clear-input {
                right: 5px;
            }
        }
    </style>
    <!-- আইকন লাইব্রেরি -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- প্রাকৃতিক সিনারি ব্যাকগ্রাউন্ড -->
    <div class="login-background">
        <div class="nature-scene">
            <div class="sun"></div>
            <div class="cloud"></div>
            <div class="cloud"></div>
            <div class="cloud"></div>
            <div class="cloud"></div>
            <div class="cloud"></div>
            <div class="bird"></div>
            <div class="bird"></div>
            <div class="bird"></div>
            <div class="tree"></div>
            <div class="tree"></div>
            <div class="tree"></div>
            <div class="tree"></div>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">SA Traders</div>
                <div class="contact-info">
                    <p>বগুড়া</p>
                    <p>ফোন: ০১৭১৩-৬৪৫৮৮৩</p>
                </div>
            </div>
        </header>

        <!-- লগইন ফর্ম -->
        <div id="loginForm" class="login-container">
            <h2>লগইন করুন</h2>
            <form id="login">
                <div class="form-group">
                    <label for="password">পাসওয়ার্ড</label>
                    <input type="password" id="password" placeholder="পাসওয়ার্ড দিন" required>
                </div>
                <button type="submit" class="btn">লগইন</button>
            </form>
        </div>

        <!-- ড্যাশবোর্ড -->
        <div id="dashboard" class="dashboard">
            <div class="dashboard-header">
                <h2>SA Traders - হিসাব ব্যবস্থাপনা</h2>
                <button class="logout-btn" id="logoutBtn">লগআউট</button>
            </div>

            <!-- স্বয়ংক্রিয় সেভ স্ট্যাটাস বার -->
            <div class="card" style="background-color: #e8f4fd; border-left: 4px solid #007bff;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <i class="fas fa-save" style="color: #007bff; margin-right: 10px;"></i>
                        <strong>স্বয়ংক্রিয় সেভ সক্রিয়</strong>
                        <span id="autoSaveStatus" style="margin-left: 10px; font-size: 14px;">পরবর্তী সেভ: ৩০ সেকেন্ড</span>
                    </div>
                    <button class="btn btn-sm btn-success" onclick="manualSave()">
                        <i class="fas fa-save"></i> এখনই সেভ করুন
                    </button>
                </div>
            </div>

            <!-- ডেটা ম্যানেজমেন্ট সিস্টেম -->
            <div class="card">
                <h3>ডেটা ম্যানেজমেন্ট</h3>
                <div class="action-buttons">
                    <button class="btn btn-success" id="saveDataBtn">সমস্ত ডেটা সেভ করুন</button>
                    <button class="btn btn-info" id="loadDataBtn">ডেটা লোড করুন</button>
                    <button class="btn btn-warning" id="backupDataBtn">ব্যাকআপ তৈরি করুন</button>
                    <button class="btn btn-secondary" id="restoreBackupBtn">ব্যাকআপ থেকে রিস্টোর করুন</button>
                    <button class="btn btn-danger" id="clearDataBtn">সমস্ত ডেটা ক্লিয়ার করুন</button>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                    <h4 style="color: #2a5298; margin-bottom: 10px;">ডেটা স্ট্যাটাস</h4>
                    <div id="dataStatus">
                        <!-- ডেটা স্ট্যাটাস এখানে দেখাবে -->
                    </div>
                </div>
            </div>

            <!-- পণ্য ব্যবস্থাপনা -->
            <div class="card">
                <h3>পণ্য ব্যবস্থাপনা</h3>
                <form id="productManagementForm" class="product-form">
                    <div class="form-group">
                        <label for="productId">পণ্য আইডি</label>
                        <div class="autocomplete-container">
                            <input type="text" id="productId" placeholder="পণ্য আইডি" list="productIdList" required>
                            <button type="button" class="clear-input" onclick="clearInput('productId')">&times;</button>
                            <datalist id="productIdList"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="productName">পণ্যের নাম</label>
                        <div class="autocomplete-container">
                            <input type="text" id="productName" placeholder="পণ্যের নাম" list="productNameList" required>
                            <button type="button" class="clear-input" onclick="clearInput('productName')">&times;</button>
                            <datalist id="productNameList"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="productPurchasePrice">ক্রয় মূল্য (প্রতি ইউনিট)</label>
                        <input type="number" id="productPurchasePrice" placeholder="ক্রয় মূল্য" required>
                    </div>
                    <div class="form-group">
                        <label for="productSellingPrice">বিক্রয় মূল্য (প্রতি ইউনিট)</label>
                        <input type="number" id="productSellingPrice" placeholder="বিক্রয় মূল্য" required>
                    </div>
                    <div class="form-group">
                        <label for="productStock">প্রারম্ভিক স্টক</label>
                        <input type="number" id="productStock" placeholder="স্টক পরিমাণ" required>
                    </div>
                    <div class="form-group">
                        <label for="productCategory">পণ্য ক্যাটাগরি</label>
                        <div class="autocomplete-container">
                            <input type="text" id="productCategory" placeholder="ক্যাটাগরি" list="categoryList">
                            <button type="button" class="clear-input" onclick="clearInput('productCategory')">&times;</button>
                            <datalist id="categoryList"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="productDescription">বিবরণ</label>
                        <input type="text" id="productDescription" placeholder="বিবরণ">
                    </div>
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-success" id="addProductBtn">পণ্য যোগ করুন</button>
                        <button type="button" class="btn btn-info" id="updateProductBtn" style="display: none;">পণ্য আপডেট করুন</button>
                        <button type="button" class="btn btn-secondary" id="cancelEditBtn" style="display: none;">বাতিল করুন</button>
                    </div>
                </form>
            </div>

            <!-- কমিশন রেট সেটিং -->
            <div class="card">
                <h3>কমিশন রেট সেটিং</h3>
                <form id="commissionForm" class="commission-form">
                    <div class="form-group">
                        <label for="commissionRate">প্রতি পণ্যের কমিশন রেট (টাকা)</label>
                        <input type="number" id="commissionRate" placeholder="কমিশন রেট" required>
                    </div>
                    <button type="submit" class="btn">কমিশন রেট সেভ করুন</button>
                </form>
                <div class="commission-info" id="currentCommissionInfo">
                    বর্তমান কমিশন রেট:  টাকা প্রতি পণ্য
                </div>
            </div>

            <!-- পণ্য ক্রয় ফর্ম -->
            <div class="card">
                <h3>পণ্য ক্রয় করুন</h3>
                <form id="purchaseProductForm" class="purchase-form">
                    <div class="form-group">
                        <label for="purchaseProductId">পণ্য আইডি</label>
                        <div class="autocomplete-container">
                            <input type="text" id="purchaseProductId" placeholder="পণ্য আইডি" list="purchaseProductIdList" required>
                            <button type="button" class="clear-input" onclick="clearInput('purchaseProductId')">&times;</button>
                            <datalist id="purchaseProductIdList"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="purchaseProductName">পণ্যের নাম</label>
                        <div class="autocomplete-container">
                            <input type="text" id="purchaseProductName" placeholder="পণ্যের নাম" list="purchaseProductNameList" required>
                            <button type="button" class="clear-input" onclick="clearInput('purchaseProductName')">&times;</button>
                            <datalist id="purchaseProductNameList"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="purchaseProductPrice">ক্রয় মূল্য (প্রতি ইউনিট)</label>
                        <input type="number" id="purchaseProductPrice" placeholder="ক্রয় মূল্য" required>
                    </div>
                    <div class="form-group">
                        <label for="purchaseProductQuantity">ক্রয় পরিমাণ</label>
                        <input type="number" id="purchaseProductQuantity" placeholder="পরিমাণ" required>
                    </div>
                    <div class="form-group">
                        <label for="purchaseProductSupplier">সাপ্লাইয়ার</label>
                        <div class="autocomplete-container">
                            <input type="text" id="purchaseProductSupplier" placeholder="সাপ্লাইয়ারের নাম" list="supplierList" required>
                            <button type="button" class="clear-input" onclick="clearInput('purchaseProductSupplier')">&times;</button>
                            <datalist id="supplierList"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="purchaseTotalAmount">মোট ক্রয় মূল্য</label>
                        <input type="number" id="purchaseTotalAmount" placeholder="মোট ক্রয় মূল্য" readonly>
                    </div>
                    <div class="form-group">
                        <label for="purchasePaidAmount">জমা দেওয়া টাকা</label>
                        <input type="number" id="purchasePaidAmount" placeholder="জমা দেওয়া টাকা" required>
                    </div>
                    <div class="form-group">
                        <label for="purchaseDueAmount">বাকি/অতিরিক্ত জমা</label>
                        <input type="number" id="purchaseDueAmount" placeholder="বাকি/অতিরিক্ত জমা" readonly>
                        <div id="purchaseDueStatus" style="margin-top: 5px; font-weight: bold;"></div>
                    </div>
                    <div class="form-group">
                        <label for="purchaseProductDate">ক্রয় তারিখ</label>
                        <input type="date" id="purchaseProductDate" required>
                    </div>
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-success" id="addPurchaseBtn">পণ্য ক্রয় করুন</button>
                        <button type="button" class="btn btn-info" id="updatePurchaseBtn" style="display: none;">ক্রয় আপডেট করুন</button>
                        <button type="button" class="btn btn-secondary" id="cancelPurchaseEditBtn" style="display: none;">বাতিল করুন</button>
                    </div>
                </form>
            </div>

            <!-- SA Traders-এর জন্য সরাসরি টাকা জমা ফর্ম -->
            <div class="card">
                <h3>SA Traders-এ সরাসরি টাকা জমা</h3>
                <form id="saTradersDepositForm" class="deposit-form">
                    <div class="form-group">
                        <label for="depositType">জমা ধরন</label>
                        <select id="depositType" required>
                            <option value="">জমা ধরন নির্বাচন করুন</option>
                            <option value="supplier">সাপ্লায়ার জমা</option>
                            <option value="customer">ক্রেতা জমা</option>
                            <option value="other">অন্যান্য জমা</option>
                        </select>
                    </div>
                    <div class="form-group" id="supplierDepositGroup" style="display: none;">
                        <label for="supplierDepositName">সাপ্লায়ার নাম</label>
                        <div class="autocomplete-container">
                            <input type="text" id="supplierDepositName" placeholder="সাপ্লায়ার নাম" list="supplierDepositList">
                            <button type="button" class="clear-input" onclick="clearInput('supplierDepositName')">&times;</button>
                            <datalist id="supplierDepositList"></datalist>
                        </div>
                    </div>
                    <div class="form-group" id="customerDepositGroup" style="display: none;">
                        <label for="customerDepositId">ক্রেতা আইডি</label>
                        <div class="autocomplete-container">
                            <input type="text" id="customerDepositId" placeholder="ক্রেতা আইডি" list="customerDepositList">
                            <button type="button" class="clear-input" onclick="clearInput('customerDepositId')">&times;</button>
                            <datalist id="customerDepositList"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="depositAmount">জমা পরিমাণ</label>
                        <input type="number" id="depositAmount" placeholder="জমা পরিমাণ" required>
                    </div>
                    <div class="form-group">
                        <label for="depositDate">জমা তারিখ</label>
                        <input type="date" id="depositDate" required>
                    </div>
                    <div class="form-group">
                        <label for="depositNotes">মন্তব্য</label>
                        <textarea id="depositNotes" placeholder="জমার বিবরণ" rows="2"></textarea>
                    </div>
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-success">জমা করুন</button>
                    </div>
                </form>
                
                <div id="recentDeposits" style="margin-top: 20px;">
                    <h4 style="color: #2a5298; margin-bottom: 10px;">সর্বশেষ জমা</h4>
                    <div id="depositList">
                        <!-- জমার তালিকা এখানে দেখাবে -->
                    </div>
                </div>
            </div>

            <!-- ক্রেতা যোগ করার ফর্ম -->
            <div class="card">
                <h3>নতুন ক্রেতা যোগ করুন</h3>
                <form id="addCustomerForm" class="customer-form">
                    <div class="form-group">
                        <label for="customerId">ক্রেতা আইডি</label>
                        <div class="autocomplete-container">
                            <input type="text" id="customerId" placeholder="ক্রেতা আইডি" list="customerIdList" required>
                            <button type="button" class="clear-input" onclick="clearInput('customerId')">&times;</button>
                            <datalist id="customerIdList"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="customerName">ক্রেতার নাম</label>
                        <div class="autocomplete-container">
                            <input type="text" id="customerName" placeholder="ক্রেতার নাম" list="customerNameList" required>
                            <button type="button" class="clear-input" onclick="clearInput('customerName')">&times;</button>
                            <datalist id="customerNameList"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="customerPhone">ফোন নম্বর</label>
                        <div class="autocomplete-container">
                            <input type="text" id="customerPhone" placeholder="ফোন নম্বর" list="phoneList">
                            <button type="button" class="clear-input" onclick="clearInput('customerPhone')">&times;</button>
                            <datalist id="phoneList"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="customerAddress">ঠিকানা</label>
                        <div class="autocomplete-container">
                            <input type="text" id="customerAddress" placeholder="ঠিকানা" list="addressList">
                            <button type="button" class="clear-input" onclick="clearInput('customerAddress')">&times;</button>
                            <datalist id="addressList"></datalist>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-success" id="addCustomerBtn">ক্রেতা যোগ করুন</button>
                        <button type="button" class="btn btn-info" id="updateCustomerBtn" style="display: none;">ক্রেতা আপডেট করুন</button>
                        <button type="button" class="btn btn-secondary" id="cancelCustomerEditBtn" style="display: none;">বাতিল করুন</button>
                    </div>
                </form>
            </div>

            <!-- লেনদেন ফর্ম (শুধুমাত্র বিক্রয়) -->
            <div class="card">
                <h3>পণ্য বিক্রয় করুন</h3>
                <form id="addTransactionForm" class="transaction-form">
                    <div class="form-group">
                        <label for="transactionCustomerId">ক্রেতা আইডি</label>
                        <div class="autocomplete-container">
                            <input type="text" id="transactionCustomerId" placeholder="ক্রেতা আইডি" list="transactionCustomerList" required>
                            <button type="button" class="clear-input" onclick="clearInput('transactionCustomerId')">&times;</button>
                            <datalist id="transactionCustomerList"></datalist>
                        </div>
                        <div class="error-message" id="customerError">ক্রেতা আইডি পাওয়া যায়নি! প্রথমে ক্রেতা যোগ করুন।</div>
                    </div>
                    <div class="form-group">
                        <label for="transactionProductId">পণ্য নির্বাচন করুন</label>
                        <select id="transactionProductId" required>
                            <option value="">পণ্য নির্বাচন করুন</option>
                        </select>
                        <div class="error-message" id="productError">পণ্য আইডি পাওয়া যায়নি! প্রথমে পণ্য যোগ করুন।</div>
                        <div class="stock-info" id="productStockInfo">স্টক: 0</div>
                    </div>
                    <div class="form-group">
                        <label for="transactionQuantity">পণ্যের পরিমাণ</label>
                        <input type="number" id="transactionQuantity" placeholder="পরিমাণ" min="1" required>
                        <div class="error-message" id="stockError">স্টক পর্যাপ্ত নেই!</div>
                    </div>
                    <div class="form-group">
                        <label for="transactionUnitPrice">বিক্রয় মূল্য (প্রতি ইউনিট)</label>
                        <input type="number" id="transactionUnitPrice" placeholder="বিক্রয় মূল্য" required>
                    </div>
                    <div class="form-group">
                        <div class="amount-display" id="totalAmountDisplay">
                            মোট মূল্য: 0 টাকা
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="paidAmount">পরিশোধিত টাকার পরিমাণ</label>
                        <input type="number" id="paidAmount" placeholder="পরিশোধিত টাকা">
                        <div class="payment-option">
                            <input type="checkbox" id="noPayment" name="noPayment">
                            <label for="noPayment">আজকে কোনো টাকা জমা দেননি</label>
                        </div>
                        <div class="amount-display" id="dueAmountDisplay">
                            বাকি/অতিরিক্ত জমা: 0 টাকা
                        </div>
                        <div id="dueStatus" style="margin-top: 5px; font-weight: bold;"></div>
                    </div>
                    <div class="form-group">
                        <label for="transactionDate">বিক্রয় তারিখ</label>
                        <input type="date" id="transactionDate" required>
                    </div>
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-success" id="addTransactionBtn">বিক্রয় সম্পন্ন করুন</button>
                        <button type="button" class="btn btn-info" id="updateTransactionBtn" style="display: none;">বিক্রয় আপডেট করুন</button>
                        <button type="button" class="btn btn-secondary" id="cancelTransactionEditBtn" style="display: none;">বাতিল করুন</button>
                    </div>
                </form>
            </div>

            <!-- স্টেটমেন্ট তৈরি -->
            <div class="card">
                <h3>হিসাব বিবরণী তৈরি করুন</h3>
                <div class="statement-options">
                    <div class="form-group">
                        <label for="statementCustomerId">ক্রেতা আইডি</label>
                        <div class="autocomplete-container">
                            <input type="text" id="statementCustomerId" placeholder="ক্রেতা আইডি" list="statementCustomerList">
                            <button type="button" class="clear-input" onclick="clearInput('statementCustomerId')">&times;</button>
                            <datalist id="statementCustomerList"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="statementPeriod">সময়কাল</label>
                        <select id="statementPeriod">
                            <option value="all">সমস্ত সময়</option>
                            <option value="daily">দৈনিক</option>
                            <option value="monthly">মাসিক</option>
                            <option value="yearly">বার্ষিক</option>
                            <option value="custom">নির্দিষ্ট তারিখ</option>
                        </select>
                    </div>
                    <div class="form-group" id="customDateRange" style="display: none;">
                        <label for="startDate">শুরুর তারিখ</label>
                        <input type="date" id="startDate">
                        <label for="endDate">শেষ তারিখ</label>
                        <input type="date" id="endDate">
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-success" id="generateCustomerStatementBtn">ক্রেতা বিবরণী তৈরি করুন</button>
                    <button class="btn btn-info" id="generateProductStatementBtn">পণ্য বিক্রয় বিবরণী</button>
                    <button class="btn btn-warning" id="generatePurchaseStatementBtn">পণ্য ক্রয় বিবরণী</button>
                    <button class="btn btn-danger" id="generateProfitLossStatementBtn">লাভ-ক্ষতি বিবরণী</button>
                    <button class="btn btn-secondary" id="generateDepositStatementBtn">জমা বিবরণী</button>
                </div>
                
                <!-- প্রিন্ট ও ডাউনলোড বাটন -->
                <div class="statement-actions no-print" id="statementActions" style="display: none;">
                    <button class="print-btn" id="printStatementBtn">
                        <i class="fas fa-print"></i> প্রিন্ট করুন
                    </button>
                    <button class="download-btn" id="downloadPDFBtn">
                        <i class="fas fa-file-pdf"></i> PDF ডাউনলোড
                    </button>
                    <button class="download-btn" id="downloadExcelBtn">
                        <i class="fas fa-file-excel"></i> এক্সেল ডাউনলোড
                    </button>
                </div>
                
                <div id="statementResult" style="margin-top: 20px;"></div>
            </div>

            <!-- পণ্যের তালিকা (স্টক সহ) -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>পণ্যের তালিকা (স্টক)</h3>
                    <div class="print-actions no-print">
                        <button class="print-btn" id="printStockBtn">
                            <i class="fas fa-print"></i> স্টক রিপোর্ট প্রিন্ট
                        </button>
                        <button class="download-btn" id="downloadStockBtn">
                            <i class="fas fa-download"></i> স্টক ডাউনলোড
                        </button>
                    </div>
                </div>
                <table id="productsTable">
                    <thead>
                        <tr>
                            <th>পণ্য আইডি</th>
                            <th>পণ্যের নাম</th>
                            <th>ক্রয় মূল্য</th>
                            <th>বিক্রয় মূল্য</th>
                            <th>বর্তমান স্টক</th>
                            <th>স্টক স্ট্যাটাস</th>
                            <th>মোট ক্রয়</th>
                            <th>মোট বিক্রয়</th>
                            <th>স্টক মূল্য</th>
                            <th>ক্যাটাগরি</th>
                            <th>অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody id="productsList">
                        <!-- পণ্যের তালিকা এখানে যোগ হবে -->
                    </tbody>
                </table>
                <div class="summary-box" style="margin-top: 20px;">
                    <h4>স্টক সারাংশ</h4>
                    <div class="summary-item">
                        <span>মোট পণ্য:</span>
                        <span id="totalProducts">0 টি</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট স্টক পরিমাণ:</span>
                        <span id="totalStockQuantity">0</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট স্টক মূল্য:</span>
                        <span id="totalStockValue">0 টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>নিম্ন স্টক পণ্য:</span>
                        <span id="lowStockProducts">0 টি</span>
                    </div>
                </div>
            </div>

            <!-- লাভ-ক্ষতি সারাংশ -->
            <div class="card">
                <h3>লাভ-ক্ষতি সারাংশ</h3>
                <div class="summary-box">
                    <div class="summary-item">
                        <span>মোট ক্রয় মূল্য:</span>
                        <span id="totalPurchaseValue">0 টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট বিক্রয় মূল্য:</span>
                        <span id="totalSalesValue">0 টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট কমিশন:</span>
                        <span id="totalCommissionValue">0 টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট লাভ/ক্ষতি:</span>
                        <span id="totalProfitLoss" class="profit-neutral">0 টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>লাভ/ক্ষতি শতাংশ:</span>
                        <span id="profitLossPercentage">0%</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট জমা (সরাসরি):</span>
                        <span id="totalDirectDeposit">0 টাকা</span>
                    </div>
                </div>
            </div>

            <!-- ক্রেতাদের তালিকা -->
            <div class="card">
                <h3>ক্রেতাদের তালিকা</h3>
                <table id="customersTable">
                    <thead>
                        <tr>
                            <th>ক্রেতা আইডি</th>
                            <th>নাম</th>
                            <th>ফোন</th>
                            <th>ঠিকানা</th>
                            <th>অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody id="customersList">
                        <!-- ক্রেতাদের তালিকা এখানে যোগ হবে -->
                    </tbody>
                </table>
            </div>

            <!-- বিক্রয়ের তালিকা -->
            <div class="card">
                <h3>বিক্রয়ের তালিকা</h3>
                <table id="transactionsTable">
                    <thead>
                        <tr>
                            <th>সিরিয়াল</th>
                            <th>তারিখ</th>
                            <th>ক্রেতা আইডি</th>
                            <th>পণ্য</th>
                            <th>পরিমাণ</th>
                            <th>ক্রয় মূল্য</th>
                            <th>বিক্রয় মূল্য</th>
                            <th>লাভ/ক্ষতি</th>
                            <th>মোট মূল্য</th>
                            <th>জমা</th>
                            <th>বাকি/অতিরিক্ত</th>
                            <th>অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsList">
                        <!-- লেনদেনের তালিকা এখানে যোগ হবে -->
                    </tbody>
                </table>
            </div>

            <!-- ক্রয়ের তালিকা -->
            <div class="card">
                <h3>ক্রয়ের তালিকা</h3>
                <table id="purchasesTable">
                    <thead>
                        <tr>
                            <th>সিরিয়াল</th>
                            <th>তারিখ</th>
                            <th>পণ্য আইডি</th>
                            <th>পণ্যের নাম</th>
                            <th>সাপ্লাইয়ার</th>
                            <th>পরিমাণ</th>
                            <th>ক্রয় মূল্য</th>
                            <th>মোট মূল্য</th>
                            <th>জমা</th>
                            <th>বাকি/অতিরিক্ত</th>
                            <th>অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody id="purchasesList">
                        <!-- ক্রয়ের তালিকা এখানে যোগ হবে -->
                    </tbody>
                </table>
            </div>

            <!-- সরাসরি জমার তালিকা -->
            <div class="card">
                <h3>সরাসরি টাকা জমার তালিকা</h3>
                <table id="depositsTable">
                    <thead>
                        <tr>
                            <th>সিরিয়াল</th>
                            <th>তারিখ</th>
                            <th>জমা ধরন</th>
                            <th>সাপ্লায়ার/ক্রেতা</th>
                            <th>জমা পরিমাণ</th>
                            <th>মন্তব্য</th>
                            <th>অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody id="depositsList">
                        <!-- জমার তালিকা এখানে যোগ হবে -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- লুকানো ফাইল ইনপুট -->
    <input type="file" id="fileInput" style="display: none;" accept=".json">
    <input type="file" id="backupFileInput" style="display: none;" accept=".json">

    <script>
        // ============================================
        // উন্নত ডেটা সংরক্ষণ ব্যবস্থা
        // ============================================
        class DataManager {
            constructor() {
                this.storageKey = 'saTradersData_v7';
                this.backupKey = 'saTradersBackup_v7';
                this.editingData = {
                    product: null,
                    customer: null,
                    transaction: null,
                    purchase: null,
                    deposit: null
                };
                this.serialCounters = {
                    transactions: this.loadCounter('transactionsCounter') || 0,
                    purchases: this.loadCounter('purchasesCounter') || 0,
                    deposits: this.loadCounter('depositsCounter') || 0
                };
                this.autocompleteData = {
                    productIds: [],
                    productNames: [],
                    customerIds: [],
                    customerNames: [],
                    suppliers: [],
                    categories: [],
                    phones: [],
                    addresses: []
                };
                this.init();
                this.startAutoSave();
                this.loadAutocompleteData();
            }
            
            init() {
                // প্রথম লোডে ডেটা চেক করুন
                if (!this.loadData()) {
                    // কোনো ডেটা না থাকলে ডিফল্ট ডেটা সেট করুন
                    this.saveDefaultData();
                }
                this.loadEditingData();
            }
            
            saveDefaultData() {
                const defaultData = {
                    customers: [],
                    products: [],
                    transactions: [],
                    purchases: [],
                    deposits: [],
                    commissionRate: 0,
                    lastUpdated: new Date().toISOString(),
                    version: '7.0'
                };
                this.saveAllData(defaultData);
            }
            
            saveAllData(data) {
                try {
                    const dataToSave = {
                        ...data,
                        lastUpdated: new Date().toISOString(),
                        version: '7.0'
                    };
                    localStorage.setItem(this.storageKey, JSON.stringify(dataToSave));
                    
                    // অটোকমপ্লিট ডেটা আপডেট করুন
                    this.updateAutocompleteData(dataToSave);
                    
                    return true;
                } catch (error) {
                    console.error('ডেটা সেভ করতে সমস্যা:', error);
                    return false;
                }
            }
            
            loadData() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    if (data) {
                        const parsedData = JSON.parse(data);
                        
                        // ডেটা ভ্যালিডেশন
                        if (this.validateData(parsedData)) {
                            return parsedData;
                        }
                    }
                    return null;
                } catch (error) {
                    console.error('ডেটা লোড করতে সমস্যা:', error);
                    return null;
                }
            }
            
            validateData(data) {
                const requiredKeys = ['customers', 'products', 'transactions', 'purchases', 'deposits', 'commissionRate'];
                return requiredKeys.every(key => key in data);
            }
            
            createBackup() {
                try {
                    const currentData = this.loadData();
                    if (currentData) {
                        localStorage.setItem(this.backupKey, JSON.stringify(currentData));
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('ব্যাকআপ তৈরি করতে সমস্যা:', error);
                    return false;
                }
            }
            
            restoreFromBackup() {
                try {
                    const backupData = localStorage.getItem(this.backupKey);
                    if (backupData) {
                        const parsedData = JSON.parse(backupData);
                        if (this.validateData(parsedData)) {
                            this.saveAllData(parsedData);
                            return true;
                        }
                    }
                    return false;
                } catch (error) {
                    console.error('ব্যাকআপ থেকে রিস্টোর করতে সমস্যা:', error);
                    return false;
                }
            }
            
            exportData() {
                const data = this.loadData();
                if (data) {
                    const dataStr = JSON.stringify(data, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `SA_Traders_Data_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    return true;
                }
                return false;
            }
            
            importData(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (this.validateData(importedData)) {
                                this.saveAllData(importedData);
                                resolve(true);
                            } else {
                                reject(new Error('ইনভ্যালিড ডেটা ফরম্যাট'));
                            }
                        } catch (error) {
                            reject(error);
                        }
                    };
                    reader.onerror = () => reject(new Error('ফাইল পড়তে সমস্যা'));
                    reader.readAsText(file);
                });
            }
            
            clearAllData() {
                try {
                    localStorage.removeItem(this.storageKey);
                    this.saveDefaultData();
                    return true;
                } catch (error) {
                    console.error('ডেটা ক্লিয়ার করতে সমস্যা:', error);
                    return false;
                }
            }
            
            // সম্পাদনা ডেটা ব্যবস্থাপনা
            setEditingData(type, data) {
                this.editingData[type] = data;
                this.saveEditingData();
            }
            
            getEditingData(type) {
                return this.editingData[type];
            }
            
            clearEditingData(type = null) {
                if (type) {
                    this.editingData[type] = null;
                } else {
                    this.editingData = {
                        product: null,
                        customer: null,
                        transaction: null,
                        purchase: null,
                        deposit: null
                    };
                }
                this.saveEditingData();
            }
            
            saveEditingData() {
                try {
                    localStorage.setItem('saTradersEditingData', JSON.stringify(this.editingData));
                } catch (error) {
                    console.error('এডিটিং ডেটা সেভ করতে সমস্যা:', error);
                }
            }
            
            loadEditingData() {
                try {
                    const data = localStorage.getItem('saTradersEditingData');
                    if (data) {
                        this.editingData = JSON.parse(data);
                    }
                } catch (error) {
                    console.error('এডিটিং ডেটা লোড করতে সমস্যা:', error);
                }
            }
            
            // সিরিয়াল নম্বর ব্যবস্থাপনা
            getNextSerial(type) {
                if (!this.serialCounters[type]) {
                    this.serialCounters[type] = 1;
                } else {
                    this.serialCounters[type]++;
                }
                
                this.saveCounter(type, this.serialCounters[type]);
                return this.serialCounters[type];
            }
            
            loadCounter(key) {
                try {
                    const counter = localStorage.getItem(`counter_${key}`);
                    return counter ? parseInt(counter) : 0;
                } catch (error) {
                    return 0;
                }
            }
            
            saveCounter(key, value) {
                try {
                    localStorage.setItem(`counter_${key}`, value.toString());
                } catch (error) {
                    console.error('কাউন্টার সেভ করতে সমস্যা:', error);
                }
            }
            
            // অটোকমপ্লিট ডেটা ব্যবস্থাপনা
            loadAutocompleteData() {
                try {
                    const data = localStorage.getItem('saTradersAutocompleteData');
                    if (data) {
                        this.autocompleteData = JSON.parse(data);
                    }
                } catch (error) {
                    console.error('অটোকমপ্লিট ডেটা লোড করতে সমস্যা:', error);
                }
            }
            
            saveAutocompleteData() {
                try {
                    localStorage.setItem('saTradersAutocompleteData', JSON.stringify(this.autocompleteData));
                } catch (error) {
                    console.error('অটোকমপ্লিট ডেটা সেভ করতে সমস্যা:', error);
                }
            }
            
            updateAutocompleteData(data) {
                // পণ্য আইডি এবং নাম
                this.autocompleteData.productIds = data.products.map(p => p.id);
                this.autocompleteData.productNames = data.products.map(p => p.name);
                
                // ক্রেতা আইডি এবং নাম
                this.autocompleteData.customerIds = data.customers.map(c => c.id);
                this.autocompleteData.customerNames = data.customers.map(c => c.name);
                
                // সাপ্লায়ার
                this.autocompleteData.suppliers = [...new Set(data.purchases.map(p => p.supplier).filter(s => s))];
                
                // ক্যাটাগরি
                this.autocompleteData.categories = [...new Set(data.products.map(p => p.category).filter(c => c))];
                
                // ফোন এবং ঠিকানা
                this.autocompleteData.phones = data.customers.map(c => c.phone).filter(p => p);
                this.autocompleteData.addresses = data.customers.map(c => c.address).filter(a => a);
                
                this.saveAutocompleteData();
            }
            
            getAutocompleteList(type) {
                return this.autocompleteData[type] || [];
            }
            
            addToAutocomplete(type, value) {
                if (value && !this.autocompleteData[type].includes(value)) {
                    this.autocompleteData[type].push(value);
                    this.saveAutocompleteData();
                }
            }
            
            // অটো সেভ ব্যবস্থাপনা
            startAutoSave() {
                setInterval(() => {
                    this.autoSave();
                }, 30000); // 30 সেকেন্ড
            }
            
            autoSave() {
                const data = this.loadData();
                if (data) {
                    this.createBackup();
                    this.updateAutoSaveStatus();
                }
            }
            
            updateAutoSaveStatus() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('bn-BD');
                document.getElementById('autoSaveStatus').innerHTML = 
                    `<span style="color: #28a745;"><i class="fas fa-check-circle"></i> শেষ সেভ: ${timeString}</span>`;
                
                // 5 সেকেন্ড পরে আবার মূল স্ট্যাটাসে ফিরে আসবে
                setTimeout(() => {
                    document.getElementById('autoSaveStatus').textContent = 'পরবর্তী সেভ: ৩০ সেকেন্ড';
                }, 5000);
            }
        }

        // গ্লোবাল ডেটা ম্যানেজার ইনস্ট্যান্স
        const dataManager = new DataManager();

        // ============================================
        // অটোকমপ্লিট ব্যবস্থাপনা
        // ============================================
        // ইনপুট ক্লিয়ার ফাংশন
        function clearInput(inputId) {
            document.getElementById(inputId).value = '';
        }

        // অটোকমপ্লিট ডেটালিস্ট আপডেট
        function updateAutocompleteLists() {
            const data = dataManager.loadData();
            
            // পণ্য আইডি লিস্ট
            const productIdList = document.getElementById('productIdList');
            productIdList.innerHTML = '';
            data.products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                productIdList.appendChild(option);
            });
            
            // পণ্য নাম লিস্ট
            const productNameList = document.getElementById('productNameList');
            productNameList.innerHTML = '';
            data.products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.name;
                productNameList.appendChild(option);
            });
            
            // ক্রেতা আইডি লিস্ট
            const customerIdList = document.getElementById('customerIdList');
            customerIdList.innerHTML = '';
            data.customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                customerIdList.appendChild(option);
            });
            
            // ক্রেতা নাম লিস্ট
            const customerNameList = document.getElementById('customerNameList');
            customerNameList.innerHTML = '';
            data.customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.name;
                customerNameList.appendChild(option);
            });
            
            // সাপ্লায়ার লিস্ট
            const supplierList = document.getElementById('supplierList');
            supplierList.innerHTML = '';
            const suppliers = [...new Set(data.purchases.map(p => p.supplier).filter(s => s))];
            suppliers.forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier;
                supplierList.appendChild(option);
            });
            
            // ক্যাটাগরি লিস্ট
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            const categories = [...new Set(data.products.map(p => p.category).filter(c => c))];
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                categoryList.appendChild(option);
            });
            
            // লেনদেন ক্রেতা লিস্ট
            const transactionCustomerList = document.getElementById('transactionCustomerList');
            transactionCustomerList.innerHTML = '';
            data.customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                transactionCustomerList.appendChild(option);
            });
            
            // স্টেটমেন্ট ক্রেতা লিস্ট
            const statementCustomerList = document.getElementById('statementCustomerList');
            statementCustomerList.innerHTML = '';
            data.customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                statementCustomerList.appendChild(option);
            });
            
            // সাপ্লায়ার জমা লিস্ট
            const supplierDepositList = document.getElementById('supplierDepositList');
            supplierDepositList.innerHTML = '';
            suppliers.forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier;
                supplierDepositList.appendChild(option);
            });
            
            // ক্রেতা জমা লিস্ট
            const customerDepositList = document.getElementById('customerDepositList');
            customerDepositList.innerHTML = '';
            data.customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                customerDepositList.appendChild(option);
            });
        }

        // ============================================
        // লগইন ব্যবস্থাপনা
        // ============================================
        document.getElementById('login').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('password').value;
            
            if (password === '884164') {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                initializeDashboard();
            } else {
                alert('ভুল পাসওয়ার্ড! সঠিক পাসওয়ার্ড দিন।');
            }
        });

        // তারিখ সেট করার ফাংশন
        function setCurrentDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('purchaseProductDate').value = today;
            document.getElementById('transactionDate').value = today;
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
            document.getElementById('depositDate').value = today;
        }

        // লগআউট
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('আপনি কি লগআউট করতে চান?')) {
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('password').value = '';
                dataManager.clearEditingData();
            }
        });

        // ============================================
        // সরাসরি টাকা জমা ব্যবস্থাপনা
        // ============================================
        // জমা ধরন পরিবর্তন
        document.getElementById('depositType').addEventListener('change', function() {
            const type = this.value;
            document.getElementById('supplierDepositGroup').style.display = 'none';
            document.getElementById('customerDepositGroup').style.display = 'none';
            
            if (type === 'supplier') {
                document.getElementById('supplierDepositGroup').style.display = 'block';
            } else if (type === 'customer') {
                document.getElementById('customerDepositGroup').style.display = 'block';
            }
        });

        // SA Traders-এ সরাসরি টাকা জমা ফর্ম
        document.getElementById('saTradersDepositForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addOrUpdateDeposit();
        });

        // সরাসরি টাকা জমা যোগ বা আপডেট করা
        function addOrUpdateDeposit() {
            const depositType = document.getElementById('depositType').value;
            const supplierName = document.getElementById('supplierDepositName')?.value || '';
            const customerId = document.getElementById('customerDepositId')?.value || '';
            const amount = parseFloat(document.getElementById('depositAmount').value) || 0;
            const date = document.getElementById('depositDate').value;
            const notes = document.getElementById('depositNotes').value;
            
            if (!depositType) {
                alert('দয়া করে জমা ধরন নির্বাচন করুন!');
                return;
            }
            
            if (amount <= 0) {
                alert('দয়া করে সঠিক জমা পরিমাণ প্রদান করুন!');
                return;
            }
            
            const data = dataManager.loadData();
            
            // এডিট মোড চেক
            const editingDeposit = dataManager.getEditingData('deposit');
            
            if (editingDeposit) {
                // বিদ্যমান জমা আপডেট
                const depositIndex = data.deposits.findIndex(d => d.id === editingDeposit.id);
                if (depositIndex !== -1) {
                    // জমা আপডেট করুন
                    data.deposits[depositIndex] = {
                        id: editingDeposit.id,
                        type: depositType,
                        supplier: depositType === 'supplier' ? supplierName : '',
                        customerId: depositType === 'customer' ? customerId : '',
                        amount: amount,
                        date: date,
                        notes: notes,
                        timestamp: new Date().toISOString(),
                        serial: editingDeposit.serial
                    };
                    
                    alert('জমা সফলভাবে আপডেট করা হয়েছে!');
                }
                
                // এডিট মোড বন্ধ করুন
                dataManager.clearEditingData('deposit');
                resetDepositForm();
            } else {
                // নতুন জমা যোগ
                const depositRecord = {
                    id: 'DEP_' + Date.now(),
                    type: depositType,
                    supplier: depositType === 'supplier' ? supplierName : '',
                    customerId: depositType === 'customer' ? customerId : '',
                    amount: amount,
                    date: date,
                    notes: notes,
                    timestamp: new Date().toISOString(),
                    serial: dataManager.getNextSerial('deposits')
                };
                
                // ডিপোজিট ডেটা যোগ করুন
                data.deposits.push(depositRecord);
                
                // অটোকমপ্লিট ডেটা আপডেট করুন
                if (depositType === 'supplier' && supplierName) {
                    dataManager.addToAutocomplete('suppliers', supplierName);
                }
                
                alert(`সফলভাবে ${formatNumber(amount)} টাকা জমা রেকর্ড করা হয়েছে!`);
            }
            
            // ডেটা সেভ করুন
            dataManager.saveAllData(data);
            
            // ফর্ম রিসেট করুন
            resetDepositForm();
            
            // তালিকা আপডেট করুন
            loadDeposits();
            updateRecentDeposits();
            updateProfitLossSummary();
            updateDataStatus();
            updateAutocompleteLists();
        }

        // জমা ফর্ম রিসেট
        function resetDepositForm() {
            document.getElementById('saTradersDepositForm').reset();
            setCurrentDate();
            document.getElementById('supplierDepositGroup').style.display = 'none';
            document.getElementById('customerDepositGroup').style.display = 'none';
            
            // এডিট মোড বন্ধ করুন
            dataManager.clearEditingData('deposit');
            const submitBtn = document.querySelector('#saTradersDepositForm button[type="submit"]');
            submitBtn.textContent = 'জমা করুন';
            submitBtn.className = 'btn btn-success';
            
            // ক্যান্সেল বাটন সরান
            const cancelBtn = document.getElementById('cancelDepositEditBtn');
            if (cancelBtn) cancelBtn.remove();
        }

        // জমার তালিকা লোড করুন
        function loadDeposits() {
            const data = dataManager.loadData();
            const deposits = data.deposits || [];
            const depositsList = document.getElementById('depositsList');
            depositsList.innerHTML = '';
            
            // তারিখ অনুযায়ী সাজান (পুরানো থেকে নতুন)
            deposits.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            deposits.forEach((deposit) => {
                let targetName = '';
                if (deposit.type === 'supplier') {
                    targetName = deposit.supplier || 'সাপ্লায়ার';
                } else if (deposit.type === 'customer') {
                    targetName = deposit.customerId ? `${deposit.customerId} - ${getCustomerName(deposit.customerId)}` : 'ক্রেতা';
                } else {
                    targetName = 'অন্যান্য';
                }
                
                const typeText = {
                    'supplier': 'সাপ্লায়ার জমা',
                    'customer': 'ক্রেতা জমা',
                    'other': 'অন্যান্য জমা'
                }[deposit.type] || deposit.type;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${deposit.serial}</td>
                    <td>${deposit.date}</td>
                    <td>${typeText}</td>
                    <td>${targetName}</td>
                    <td>${formatNumber(deposit.amount)} টাকা</td>
                    <td>${deposit.notes || '-'}</td>
                    <td>
                        <button class="edit-btn" onclick="editDeposit('${deposit.id}')">এডিট</button>
                        <button class="delete-btn" onclick="deleteDeposit('${deposit.id}')">ডিলিট</button>
                    </td>
                `;
                depositsList.appendChild(row);
            });
        }

        // জমা এডিট ফাংশন
        function editDeposit(depositId) {
            const data = dataManager.loadData();
            const deposit = data.deposits.find(d => d.id === depositId);
            
            if (!deposit) return;
            
            document.getElementById('depositType').value = deposit.type;
            document.getElementById('supplierDepositName').value = deposit.supplier || '';
            document.getElementById('customerDepositId').value = deposit.customerId || '';
            document.getElementById('depositAmount').value = deposit.amount;
            document.getElementById('depositDate').value = deposit.date;
            document.getElementById('depositNotes').value = deposit.notes || '';
            
            // ধরন অনুযায়ী গ্রুপ দেখান
            if (deposit.type === 'supplier') {
                document.getElementById('supplierDepositGroup').style.display = 'block';
            } else if (deposit.type === 'customer') {
                document.getElementById('customerDepositGroup').style.display = 'block';
            }
            
            // ফর্মের বাটন আপডেট
            const submitBtn = document.querySelector('#saTradersDepositForm button[type="submit"]');
            submitBtn.textContent = 'জমা আপডেট করুন';
            submitBtn.className = 'btn btn-warning';
            
            // এডিটিং ডেটা সংরক্ষণ
            dataManager.setEditingData('deposit', deposit);
            
            // একটি ক্যান্সেল বাটন যোগ করুন
            const cancelBtn = document.createElement('button');
            cancelBtn.type = 'button';
            cancelBtn.id = 'cancelDepositEditBtn';
            cancelBtn.className = 'btn btn-secondary';
            cancelBtn.textContent = 'বাতিল করুন';
            cancelBtn.style.marginLeft = '10px';
            cancelBtn.onclick = function() {
                resetDepositForm();
            };
            
            const actionButtons = document.querySelector('#saTradersDepositForm .action-buttons');
            if (!document.getElementById('cancelDepositEditBtn')) {
                actionButtons.appendChild(cancelBtn);
            }
        }

        // জমা ডিলিট ফাংশন
        function deleteDeposit(depositId) {
            if (confirm('আপনি কি এই জমা রেকর্ড ডিলিট করতে চান?')) {
                const data = dataManager.loadData();
                const depositIndex = data.deposits.findIndex(d => d.id === depositId);
                
                if (depositIndex === -1) return;
                
                data.deposits.splice(depositIndex, 1);
                dataManager.saveAllData(data);
                
                // তালিকা আপডেট করুন
                loadDeposits();
                updateRecentDeposits();
                updateProfitLossSummary();
                updateDataStatus();
                
                alert('জমা রেকর্ড সফলভাবে ডিলিট করা হয়েছে!');
            }
        }

        // সাম্প্রতিক জমা আপডেট করুন
        function updateRecentDeposits() {
            const data = dataManager.loadData();
            const deposits = data.deposits || [];
            const depositList = document.getElementById('depositList');
            
            // শুধুমাত্র শেষ ৫টি জমা দেখান (নতুন থেকে পুরানো)
            const recentDeposits = deposits
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (recentDeposits.length === 0) {
                depositList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #666; background: #f8f9fa; border-radius: 5px;">
                        কোনো জমা রেকর্ড পাওয়া যায়নি
                    </div>
                `;
                return;
            }
            
            let depositsHTML = '';
            recentDeposits.forEach(deposit => {
                const typeText = {
                    'supplier': 'সাপ্লাইয়ার জমা',
                    'customer': 'ক্রেতা জমা',
                    'other': 'অন্যান্য জমা'
                }[deposit.type] || deposit.type;
                
                depositsHTML += `
                    <div class="deposit-record">
                        <div style="display: flex; justify-content: space-between;">
                            <div>
                                <strong>${typeText}</strong><br>
                                <small>${deposit.date}</small>
                            </div>
                            <div style="font-weight: bold; color: #28a745;">
                                ${formatNumber(deposit.amount)} টাকা
                            </div>
                        </div>
                        ${deposit.notes ? `<div style="margin-top: 5px; font-size: 12px;">${deposit.notes}</div>` : ''}
                    </div>
                `;
            });
            
            depositList.innerHTML = depositsHTML;
        }

        // ============================================
        // কমিশন রেট ব্যবস্থাপনা
        // ============================================
        document.getElementById('commissionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const commissionRate = parseFloat(document.getElementById('commissionRate').value) || 0;
            
            const currentData = dataManager.loadData();
            currentData.commissionRate = commissionRate;
            dataManager.saveAllData(currentData);
            
            loadCommissionRate();
            
            alert('কমিশন রেট সফলভাবে সেভ করা হয়েছে!');
        });

        // কমিশন রেট লোড করা
        function loadCommissionRate() {
            const data = dataManager.loadData();
            const commissionRate = data.commissionRate || 0;
            document.getElementById('commissionRate').value = commissionRate;
            document.getElementById('currentCommissionInfo').textContent = 
                `বর্তমান কমিশন রেট: ${formatNumber(commissionRate)} টাকা প্রতি পণ্য`;
        }

        // ============================================
        // পণ্য ব্যবস্থাপনা
        // ============================================
        document.getElementById('productManagementForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addOrUpdateProduct();
        });

        // পণ্য যোগ বা আপডেট করার ফাংশন
        function addOrUpdateProduct() {
            const productId = document.getElementById('productId').value.trim();
            const productName = document.getElementById('productName').value.trim();
            const purchasePrice = parseFloat(document.getElementById('productPurchasePrice').value) || 0;
            const sellingPrice = parseFloat(document.getElementById('productSellingPrice').value) || 0;
            const stock = parseInt(document.getElementById('productStock').value) || 0;
            const category = document.getElementById('productCategory').value.trim();
            const description = document.getElementById('productDescription').value.trim();
            
            const data = dataManager.loadData();
            const products = data.products;
            
            // এডিট মোড চেক
            const editingProduct = dataManager.getEditingData('product');
            
            if (editingProduct) {
                // বিদ্যমান পণ্য আপডেট
                const existingProductIndex = products.findIndex(p => p.id === editingProduct.id);
                if (existingProductIndex !== -1) {
                    // পুরানো স্টক রেকর্ড রাখুন
                    const oldStock = products[existingProductIndex].stock;
                    const oldTotalPurchased = products[existingProductIndex].totalPurchased;
                    const oldTotalSold = products[existingProductIndex].totalSold;
                    
                    products[existingProductIndex] = {
                        id: productId,
                        name: productName,
                        purchasePrice: purchasePrice,
                        sellingPrice: sellingPrice,
                        stock: stock,
                        totalPurchased: oldTotalPurchased + (stock - oldStock > 0 ? stock - oldStock : 0),
                        totalSold: oldTotalSold,
                        category: category,
                        description: description,
                        lastUpdated: new Date().toISOString().split('T')[0]
                    };
                    
                    alert('পণ্য সফলভাবে আপডেট করা হয়েছে!');
                }
                
                // এডিট মোড বন্ধ করুন
                dataManager.clearEditingData('product');
                resetProductForm();
            } else {
                // নতুন পণ্য যোগ
                // আইডি ডুপ্লিকেট চেক
                if (products.some(p => p.id === productId)) {
                    alert('এই পণ্য আইডি ইতিমধ্যে বিদ্যমান! দয়া করে ভিন্ন আইডি ব্যবহার করুন।');
                    return;
                }
                
                products.push({
                    id: productId,
                    name: productName,
                    purchasePrice: purchasePrice,
                    sellingPrice: sellingPrice,
                    stock: stock,
                    totalPurchased: stock,
                    totalSold: 0,
                    category: category,
                    description: description,
                    lastUpdated: new Date().toISOString().split('T')[0]
                });
                
                // অটোকমপ্লিট ডেটা আপডেট করুন
                dataManager.addToAutocomplete('productIds', productId);
                dataManager.addToAutocomplete('productNames', productName);
                if (category) {
                    dataManager.addToAutocomplete('categories', category);
                }
                
                alert('পণ্য সফলভাবে যোগ করা হয়েছে!');
            }
            
            data.products = products;
            dataManager.saveAllData(data);
            
            // ফর্ম রিসেট
            resetProductForm();
            
            // তালিকা আপডেট
            loadProducts();
            updateProductDropdown();
            updateProfitLossSummary();
            updateDataStatus();
            updateAutocompleteLists();
        }

        // পণ্য ফর্ম রিসেট
        function resetProductForm() {
            document.getElementById('productManagementForm').reset();
            document.getElementById('updateProductBtn').style.display = 'none';
            document.getElementById('cancelEditBtn').style.display = 'none';
            document.getElementById('addProductBtn').style.display = 'block';
            document.getElementById('addProductBtn').textContent = 'পণ্য যোগ করুন';
            dataManager.clearEditingData('product');
        }

        // পণ্য এডিট ফাংশন
        function editProduct(productId) {
            const data = dataManager.loadData();
            const product = data.products.find(p => p.id === productId);
            
            if (!product) return;
            
            document.getElementById('productId').value = product.id;
            document.getElementById('productName').value = product.name;
            document.getElementById('productPurchasePrice').value = product.purchasePrice;
            document.getElementById('productSellingPrice').value = product.sellingPrice;
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productCategory').value = product.category || '';
            document.getElementById('productDescription').value = product.description || '';
            
            document.getElementById('updateProductBtn').style.display = 'block';
            document.getElementById('cancelEditBtn').style.display = 'block';
            document.getElementById('addProductBtn').style.display = 'none';
            document.getElementById('updateProductBtn').textContent = 'পণ্য আপডেট করুন';
            
            // এডিটিং ডেটা সংরক্ষণ
            dataManager.setEditingData('product', product);
        }

        // পণ্য এডিট বাতিল
        document.getElementById('cancelEditBtn').addEventListener('click', function() {
            resetProductForm();
        });

        // পণ্য ডিলিট ফাংশন
        function deleteProduct(productId) {
            if (confirm('আপনি কি এই পণ্য ডিলিট করতে চান? এই পণ্যের সাথে সম্পর্কিত সমস্ত বিক্রয় ডাটাও ডিলিট হবে!')) {
                const data = dataManager.loadData();
                const productIndex = data.products.findIndex(p => p.id === productId);
                
                if (productIndex === -1) return;
                
                const product = data.products[productIndex];
                
                // পণ্য ডিলিট
                data.products.splice(productIndex, 1);
                
                // এই পণ্যের সাথে সম্পর্কিত বিক্রয় ডাটা ডিলিট
                data.transactions = data.transactions.filter(t => t.productId !== product.id);
                
                dataManager.saveAllData(data);
                
                // তালিকা আপডেট
                loadProducts();
                loadTransactions();
                updateProductDropdown();
                updateProfitLossSummary();
                updateDataStatus();
                updateAutocompleteLists();
                
                alert('পণ্য সফলভাবে ডিলিট করা হয়েছে!');
            }
        }

        // ============================================
        // পণ্য ক্রয় ব্যবস্থাপনা
        // ============================================
        // ক্রয় মূল্য এবং পরিমাণ পরিবর্তনে মোট মূল্য হিসাব
        document.getElementById('purchaseProductPrice').addEventListener('input', calculatePurchaseTotal);
        document.getElementById('purchaseProductQuantity').addEventListener('input', calculatePurchaseTotal);
        
        // জমা দেওয়া টাকা পরিবর্তনে বাকি টাকা হিসাব
        document.getElementById('purchasePaidAmount').addEventListener('input', calculatePurchaseDue);

        // ক্রয়ের মোট মূল্য হিসাব
        function calculatePurchaseTotal() {
            const price = parseFloat(document.getElementById('purchaseProductPrice').value) || 0;
            const quantity = parseInt(document.getElementById('purchaseProductQuantity').value) || 0;
            const totalAmount = price * quantity;
            
            document.getElementById('purchaseTotalAmount').value = totalAmount.toFixed(2);
            calculatePurchaseDue();
        }

        // ক্রয়ের বাকি/অতিরিক্ত জমা হিসাব
        function calculatePurchaseDue() {
            const totalAmount = parseFloat(document.getElementById('purchaseTotalAmount').value) || 0;
            const paidAmount = parseFloat(document.getElementById('purchasePaidAmount').value) || 0;
            const dueAmount = totalAmount - paidAmount;
            
            document.getElementById('purchaseDueAmount').value = dueAmount.toFixed(2);
            
            // স্ট্যাটাস আপডেট
            const dueStatus = document.getElementById('purchaseDueStatus');
            if (dueAmount > 0) {
                dueStatus.textContent = 'বাকি আছে: ' + formatNumber(dueAmount) + ' টাকা';
                dueStatus.style.color = '#dc3545';
                dueStatus.className = 'due-negative';
            } else if (dueAmount < 0) {
                dueStatus.textContent = 'অতিরিক্ত জমা: ' + formatNumber(Math.abs(dueAmount)) + ' টাকা';
                dueStatus.style.color = '#28a745';
                dueStatus.className = 'due-positive';
            } else {
                dueStatus.textContent = 'পরিশোধিত';
                dueStatus.style.color = '#28a745';
                dueStatus.className = 'due-positive';
            }
        }

        document.getElementById('purchaseProductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addOrUpdatePurchase();
        });

        // পণ্য ক্রয় করা বা আপডেট করা
        function addOrUpdatePurchase() {
            const productId = document.getElementById('purchaseProductId').value.trim();
            const productName = document.getElementById('purchaseProductName').value.trim();
            const purchasePrice = parseFloat(document.getElementById('purchaseProductPrice').value) || 0;
            const quantity = parseInt(document.getElementById('purchaseProductQuantity').value) || 0;
            const supplier = document.getElementById('purchaseProductSupplier').value.trim();
            const totalAmount = parseFloat(document.getElementById('purchaseTotalAmount').value) || 0;
            const paidAmount = parseFloat(document.getElementById('purchasePaidAmount').value) || 0;
            const dueAmount = parseFloat(document.getElementById('purchaseDueAmount').value) || 0;
            const date = document.getElementById('purchaseProductDate').value;
            
            const data = dataManager.loadData();
            
            // এডিট মোড চেক
            const editingPurchase = dataManager.getEditingData('purchase');
            
            if (editingPurchase) {
                // বিদ্যমান ক্রয় আপডেট
                const purchases = data.purchases;
                const existingPurchaseIndex = purchases.findIndex(p => p.id === editingPurchase.id);
                
                if (existingPurchaseIndex !== -1) {
                    // পুরানো ক্রয় বাতিল করুন (স্টক থেকে বাদ দিন)
                    const oldPurchase = purchases[existingPurchaseIndex];
                    cancelOldPurchase(oldPurchase, data);
                    
                    // নতুন ক্রয় যোগ করুন
                    purchases[existingPurchaseIndex] = {
                        id: editingPurchase.id,
                        productId: productId,
                        productName: productName,
                        purchasePrice: purchasePrice,
                        quantity: quantity,
                        supplier: supplier,
                        totalAmount: totalAmount,
                        paidAmount: paidAmount,
                        dueAmount: dueAmount,
                        date: date,
                        serial: editingPurchase.serial
                    };
                    
                    // নতুন ক্রয়ের স্টক আপডেট
                    updateProductStock(productId, productName, purchasePrice, quantity, date, data);
                    
                    alert('ক্রয় সফলভাবে আপডেট করা হয়েছে!');
                }
                
                // এডিট মোড বন্ধ করুন
                dataManager.clearEditingData('purchase');
                resetPurchaseForm();
            } else {
                // নতুন ক্রয় যোগ
                const purchases = data.purchases;
                const purchaseId = 'PUR_' + Date.now();
                purchases.push({
                    id: purchaseId,
                    productId: productId,
                    productName: productName,
                    purchasePrice: purchasePrice,
                    quantity: quantity,
                    supplier: supplier,
                    totalAmount: totalAmount,
                    paidAmount: paidAmount,
                    dueAmount: dueAmount,
                    date: date,
                    serial: dataManager.getNextSerial('purchases')
                });
                data.purchases = purchases;
                
                // স্টক আপডেট
                updateProductStock(productId, productName, purchasePrice, quantity, date, data);
                
                // অটোকমপ্লিট ডেটা আপডেট করুন
                dataManager.addToAutocomplete('suppliers', supplier);
                
                alert('পণ্য সফলভাবে ক্রয় করা হয়েছে!');
            }
            
            dataManager.saveAllData(data);
            
            // ফর্ম রিসেট
            resetPurchaseForm();
            
            // তালিকা আপডেট
            loadProducts();
            loadPurchases();
            updateProductDropdown();
            updateProfitLossSummary();
            updateDataStatus();
            updateAutocompleteLists();
        }

        // পুরানো ক্রয় বাতিল (স্টক থেকে বাদ)
        function cancelOldPurchase(purchase, data) {
            const productIndex = data.products.findIndex(p => p.id === purchase.productId);
            if (productIndex !== -1) {
                data.products[productIndex].stock -= purchase.quantity;
                data.products[productIndex].totalPurchased -= purchase.quantity;
                
                // যদি স্টক নেগেটিভ হয়, তাহলে 0 সেট করুন
                if (data.products[productIndex].stock < 0) {
                    data.products[productIndex].stock = 0;
                }
                
                if (data.products[productIndex].totalPurchased < 0) {
                    data.products[productIndex].totalPurchased = 0;
                }
            }
        }

        // পণ্য স্টক আপডেট
        function updateProductStock(productId, productName, purchasePrice, quantity, date, data) {
            const products = data.products;
            const existingProductIndex = products.findIndex(p => p.id === productId);
            
            if (existingProductIndex !== -1) {
                // বিদ্যমান পণ্য আপডেট
                products[existingProductIndex].stock += quantity;
                products[existingProductIndex].totalPurchased += quantity;
                products[existingProductIndex].lastUpdated = date;
            } else {
                // নতুন পণ্য যোগ
                products.push({
                    id: productId,
                    name: productName,
                    purchasePrice: purchasePrice,
                    sellingPrice: purchasePrice * 1.2, // 20% মার্জিন
                    stock: quantity,
                    totalPurchased: quantity,
                    totalSold: 0,
                    category: '',
                    description: '',
                    lastUpdated: date
                });
            }
            
            data.products = products;
        }

        // ক্রয় ফর্ম রিসেট
        function resetPurchaseForm() {
            document.getElementById('purchaseProductForm').reset();
            document.getElementById('updatePurchaseBtn').style.display = 'none';
            document.getElementById('cancelPurchaseEditBtn').style.display = 'none';
            document.getElementById('addPurchaseBtn').style.display = 'block';
            document.getElementById('addPurchaseBtn').textContent = 'পণ্য ক্রয় করুন';
            setCurrentDate();
            calculatePurchaseTotal();
            dataManager.clearEditingData('purchase');
        }

        // ক্রয় এডিট ফাংশন
        function editPurchase(purchaseId) {
            const data = dataManager.loadData();
            const purchase = data.purchases.find(p => p.id === purchaseId);
            
            if (!purchase) return;
            
            document.getElementById('purchaseProductId').value = purchase.productId;
            document.getElementById('purchaseProductName').value = purchase.productName;
            document.getElementById('purchaseProductPrice').value = purchase.purchasePrice;
            document.getElementById('purchaseProductQuantity').value = purchase.quantity;
            document.getElementById('purchaseProductSupplier').value = purchase.supplier;
            document.getElementById('purchaseTotalAmount').value = purchase.totalAmount;
            document.getElementById('purchasePaidAmount').value = purchase.paidAmount;
            document.getElementById('purchaseDueAmount').value = purchase.dueAmount;
            document.getElementById('purchaseProductDate').value = purchase.date;
            
            calculatePurchaseDue();
            
            document.getElementById('updatePurchaseBtn').style.display = 'block';
            document.getElementById('cancelPurchaseEditBtn').style.display = 'block';
            document.getElementById('addPurchaseBtn').style.display = 'none';
            document.getElementById('updatePurchaseBtn').textContent = 'ক্রয় আপডেট করুন';
            
            // এডিটিং ডেটা সংরক্ষণ
            dataManager.setEditingData('purchase', purchase);
        }

        // ক্রয় এডিট বাতিল
        document.getElementById('cancelPurchaseEditBtn').addEventListener('click', function() {
            resetPurchaseForm();
        });

        // ক্রয় ডিলিট ফাংশন
        function deletePurchase(purchaseId) {
            if (confirm('আপনি কি এই ক্রয় ডিলিট করতে চান? স্টক থেকে এই ক্রয়ের পরিমাণ বাদ দেওয়া হবে!')) {
                const data = dataManager.loadData();
                const purchaseIndex = data.purchases.findIndex(p => p.id === purchaseId);
                
                if (purchaseIndex === -1) return;
                
                const purchase = data.purchases[purchaseIndex];
                
                // স্টক হ্রাস করুন
                if (purchase) {
                    const productIndex = data.products.findIndex(product => product.id === purchase.productId);
                    
                    if (productIndex !== -1) {
                        data.products[productIndex].stock -= purchase.quantity;
                        data.products[productIndex].totalPurchased -= purchase.quantity;
                        
                        // যদি স্টক 0 বা নেগেটিভ হয়, তাহলে 0 সেট করুন
                        if (data.products[productIndex].stock < 0) {
                            data.products[productIndex].stock = 0;
                        }
                        
                        if (data.products[productIndex].totalPurchased < 0) {
                            data.products[productIndex].totalPurchased = 0;
                        }
                    }
                }
                
                data.purchases.splice(purchaseIndex, 1);
                dataManager.saveAllData(data);
                loadPurchases();
                loadProducts();
                updateProductDropdown();
                updateProfitLossSummary();
                updateDataStatus();
                
                alert('ক্রয় সফলভাবে ডিলিট করা হয়েছে!');
            }
        }

        // ============================================
        // ক্রেতা ব্যবস্থাপনা
        // ============================================
        document.getElementById('addCustomerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addOrUpdateCustomer();
        });

        // ক্রেতা যোগ বা আপডেট করা
        function addOrUpdateCustomer() {
            const customerId = document.getElementById('customerId').value.trim();
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const customerAddress = document.getElementById('customerAddress').value.trim();
            
            const data = dataManager.loadData();
            const customers = data.customers;
            
            // এডিট মোড চেক
            const editingCustomer = dataManager.getEditingData('customer');
            
            if (editingCustomer) {
                // বিদ্যমান ক্রেতা আপডেট
                const existingCustomerIndex = customers.findIndex(c => c.id === editingCustomer.id);
                if (existingCustomerIndex !== -1) {
                    customers[existingCustomerIndex] = {
                        id: customerId,
                        name: customerName,
                        phone: customerPhone,
                        address: customerAddress
                    };
                    
                    alert('ক্রেতা সফলভাবে আপডেট করা হয়েছে!');
                }
                
                // এডিট মোড বন্ধ করুন
                dataManager.clearEditingData('customer');
                resetCustomerForm();
            } else {
                // নতুন ক্রেতা যোগ
                // আইডি ডুপ্লিকেট চেক
                if (customers.some(c => c.id === customerId)) {
                    alert('এই ক্রেতা আইডি ইতিমধ্যে বিদ্যমান! দয়া করে ভিন্ন আইডি ব্যবহার করুন।');
                    return;
                }
                
                customers.push({
                    id: customerId,
                    name: customerName,
                    phone: customerPhone,
                    address: customerAddress
                });
                
                // অটোকমপ্লিট ডেটা আপডেট করুন
                dataManager.addToAutocomplete('customerIds', customerId);
                dataManager.addToAutocomplete('customerNames', customerName);
                if (customerPhone) {
                    dataManager.addToAutocomplete('phones', customerPhone);
                }
                if (customerAddress) {
                    dataManager.addToAutocomplete('addresses', customerAddress);
                }
                
                alert('ক্রেতা সফলভাবে যোগ করা হয়েছে!');
            }
            
            data.customers = customers;
            dataManager.saveAllData(data);
            
            // ফর্ম রিসেট
            resetCustomerForm();
            
            // তালিকা আপডেট
            loadCustomers();
            updateDataStatus();
            updateAutocompleteLists();
        }

        // ক্রেতা ফর্ম রিসেট
        function resetCustomerForm() {
            document.getElementById('addCustomerForm').reset();
            document.getElementById('updateCustomerBtn').style.display = 'none';
            document.getElementById('cancelCustomerEditBtn').style.display = 'none';
            document.getElementById('addCustomerBtn').style.display = 'block';
            document.getElementById('addCustomerBtn').textContent = 'ক্রেতা যোগ করুন';
            dataManager.clearEditingData('customer');
        }

        // ক্রেতা এডিট ফাংশন
        function editCustomer(customerId) {
            const data = dataManager.loadData();
            const customer = data.customers.find(c => c.id === customerId);
            
            if (!customer) return;
            
            document.getElementById('customerId').value = customer.id;
            document.getElementById('customerName').value = customer.name;
            document.getElementById('customerPhone').value = customer.phone || '';
            document.getElementById('customerAddress').value = customer.address || '';
            
            document.getElementById('updateCustomerBtn').style.display = 'block';
            document.getElementById('cancelCustomerEditBtn').style.display = 'block';
            document.getElementById('addCustomerBtn').style.display = 'none';
            document.getElementById('updateCustomerBtn').textContent = 'ক্রেতা আপডেট করুন';
            
            // এডিটিং ডেটা সংরক্ষণ
            dataManager.setEditingData('customer', customer);
        }

        // ক্রেতা এডিট বাতিল
        document.getElementById('cancelCustomerEditBtn').addEventListener('click', function() {
            resetCustomerForm();
        });

        // ক্রেতা ডিলিট ফাংশন
        function deleteCustomer(customerId) {
            if (confirm('আপনি কি এই ক্রেতা ডিলিট করতে চান? এই ক্রেতার সাথে সম্পর্কিত সমস্ত বিক্রয় ডাটাও ডিলিট হবে!')) {
                const data = dataManager.loadData();
                const customerIndex = data.customers.findIndex(c => c.id === customerId);
                
                if (customerIndex === -1) return;
                
                const customer = data.customers[customerIndex];
                
                // ক্রেতা ডিলিট
                data.customers.splice(customerIndex, 1);
                
                // এই ক্রেতার সাথে সম্পর্কিত বিক্রয় ডাটা ডিলিট
                data.transactions = data.transactions.filter(t => t.customerId !== customer.id);
                
                dataManager.saveAllData(data);
                loadCustomers();
                loadTransactions();
                updateProfitLossSummary();
                updateDataStatus();
                updateAutocompleteLists();
                
                alert('ক্রেতা সফলভাবে ডিলিট করা হয়েছে!');
            }
        }

        // ============================================
        // বিক্রয় ব্যবস্থাপনা
        // ============================================
        // পণ্য নির্বাচন পরিবর্তন
        document.getElementById('transactionProductId').addEventListener('change', function() {
            updateProductInfo();
        });

        // পরিমাণ পরিবর্তন
        document.getElementById('transactionQuantity').addEventListener('input', function() {
            calculateTotalAmount();
            checkStockAvailability();
        });

        // বিক্রয় মূল্য পরিবর্তন
        document.getElementById('transactionUnitPrice').addEventListener('input', function() {
            calculateTotalAmount();
        });
        
        // পরিশোধিত টাকা পরিবর্তন
        document.getElementById('paidAmount').addEventListener('input', calculateDueAmount);
        
        // আজকে টাকা জমা না দেওয়ার অপশন
        document.getElementById('noPayment').addEventListener('change', function() {
            const paidAmountField = document.getElementById('paidAmount');
            if (this.checked) {
                paidAmountField.value = '0';
                paidAmountField.disabled = true;
            } else {
                paidAmountField.disabled = false;
            }
            calculateDueAmount();
        });

        // পণ্য তথ্য আপডেট
        function updateProductInfo() {
            const productId = document.getElementById('transactionProductId').value;
            const data = dataManager.loadData();
            const selectedProduct = data.products.find(product => product.id === productId);
            
            if (selectedProduct) {
                document.getElementById('productStockInfo').textContent = `স্টক: ${selectedProduct.stock}`;
                document.getElementById('productStockInfo').style.display = 'block';
                document.getElementById('transactionUnitPrice').value = selectedProduct.sellingPrice || selectedProduct.purchasePrice * 1.2;
                calculateTotalAmount();
                checkStockAvailability();
            } else {
                document.getElementById('transactionUnitPrice').value = '';
                document.getElementById('totalAmountDisplay').textContent = 'মোট মূল্য: 0 টাকা';
                document.getElementById('productStockInfo').style.display = 'none';
            }
        }

        // স্টক চেক
        function checkStockAvailability() {
            const productId = document.getElementById('transactionProductId').value;
            const quantity = parseInt(document.getElementById('transactionQuantity').value) || 0;
            const data = dataManager.loadData();
            const selectedProduct = data.products.find(product => product.id === productId);
            
            if (selectedProduct && quantity > selectedProduct.stock) {
                document.getElementById('stockError').style.display = 'block';
                return false;
            } else {
                document.getElementById('stockError').style.display = 'none';
                return true;
            }
        }

        // মোট মূল্য হিসাব
        function calculateTotalAmount() {
            const quantity = parseInt(document.getElementById('transactionQuantity').value) || 0;
            const unitPrice = parseFloat(document.getElementById('transactionUnitPrice').value) || 0;
            const totalAmount = quantity * unitPrice;
            
            document.getElementById('totalAmountDisplay').textContent = `মোট মূল্য: ${formatNumber(totalAmount)} টাকা`;
            calculateDueAmount();
        }

        // বাকি/অতিরিক্ত জমা হিসাব
        function calculateDueAmount() {
            const quantity = parseInt(document.getElementById('transactionQuantity').value) || 0;
            const unitPrice = parseFloat(document.getElementById('transactionUnitPrice').value) || 0;
            const totalAmount = quantity * unitPrice;
            const paidAmount = parseFloat(document.getElementById('paidAmount').value) || 0;
            const dueAmount = totalAmount - paidAmount;
            
            document.getElementById('dueAmountDisplay').textContent = `বাকি/অতিরিক্ত জমা: ${formatNumber(dueAmount)} টাকা`;
            
            // স্ট্যাটাস আপডেট
            const dueStatus = document.getElementById('dueStatus');
            if (dueAmount > 0) {
                dueStatus.textContent = 'বাকি আছে: ' + formatNumber(dueAmount) + ' টাকা';
                dueStatus.style.color = '#dc3545';
                dueStatus.className = 'due-negative';
            } else if (dueAmount < 0) {
                dueStatus.textContent = 'অতিরিক্ত জমা: ' + formatNumber(Math.abs(dueAmount)) + ' টাকা';
                dueStatus.style.color = '#28a745';
                dueStatus.className = 'due-positive';
            } else {
                dueStatus.textContent = 'পরিশোধিত';
                dueStatus.style.color = '#28a745';
                dueStatus.className = 'due-positive';
            }
        }

        document.getElementById('addTransactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addOrUpdateTransaction();
        });

        // বিক্রয় যোগ বা আপডেট করা
        function addOrUpdateTransaction() {
            const customerId = document.getElementById('transactionCustomerId').value.trim();
            const productId = document.getElementById('transactionProductId').value;
            const quantity = parseInt(document.getElementById('transactionQuantity').value) || 0;
            const unitPrice = parseFloat(document.getElementById('transactionUnitPrice').value) || 0;
            const totalAmount = quantity * unitPrice;
            const paidAmount = parseFloat(document.getElementById('paidAmount').value) || 0;
            const dueAmount = totalAmount - paidAmount;
            const date = document.getElementById('transactionDate').value;
            
            const data = dataManager.loadData();
            
            // ক্রেতা আইডি চেক
            const customerExists = data.customers.some(customer => customer.id === customerId);
            
            if (!customerExists) {
                document.getElementById('customerError').style.display = 'block';
                return;
            } else {
                document.getElementById('customerError').style.display = 'none';
            }
            
            // পণ্য আইডি চেক
            const productExists = data.products.some(product => product.id === productId);
            
            if (!productExists) {
                document.getElementById('productError').style.display = 'block';
                return;
            } else {
                document.getElementById('productError').style.display = 'none';
            }
            
            // স্টক চেক
            if (!checkStockAvailability()) {
                alert('স্টক পর্যাপ্ত নেই!');
                return;
            }
            
            // ক্রয় মূল্য পাওয়া
            const product = data.products.find(p => p.id === productId);
            const purchasePrice = product ? product.purchasePrice : 0;
            const profitLoss = (unitPrice - purchasePrice) * quantity;
            
            // এডিট মোড চেক
            const editingTransaction = dataManager.getEditingData('transaction');
            
            if (editingTransaction) {
                // বিদ্যমান বিক্রয় আপডেট
                const transactions = data.transactions;
                const existingTransactionIndex = transactions.findIndex(t => t.id === editingTransaction.id);
                
                if (existingTransactionIndex !== -1) {
                    // পুরানো বিক্রয় বাতিল করুন (স্টক ফেরত)
                    const oldTransaction = transactions[existingTransactionIndex];
                    cancelOldTransaction(oldTransaction, data);
                    
                    // নতুন বিক্রয় যোগ করুন
                    const productIndex = data.products.findIndex(product => product.id === productId);
                    if (productIndex !== -1 && data.products[productIndex].stock >= quantity) {
                        data.products[productIndex].stock -= quantity;
                        data.products[productIndex].totalSold += quantity;
                        data.products[productIndex].lastUpdated = date;
                    }
                    
                    transactions[existingTransactionIndex] = {
                        id: editingTransaction.id,
                        customerId: customerId,
                        productId: productId,
                        quantity: quantity,
                        unitPrice: unitPrice,
                        purchasePrice: purchasePrice,
                        profitLoss: profitLoss,
                        totalAmount: totalAmount,
                        paidAmount: paidAmount,
                        dueAmount: dueAmount,
                        date: date,
                        type: 'sale',
                        serial: editingTransaction.serial
                    };
                    
                    alert('বিক্রয় সফলভাবে আপডেট করা হয়েছে!');
                }
                
                // এডিট মোড বন্ধ করুন
                dataManager.clearEditingData('transaction');
                resetTransactionForm();
            } else {
                // স্টক আপডেট
                const productIndex = data.products.findIndex(product => product.id === productId);
                if (productIndex !== -1 && data.products[productIndex].stock >= quantity) {
                    data.products[productIndex].stock -= quantity;
                    data.products[productIndex].totalSold += quantity;
                    data.products[productIndex].lastUpdated = date;
                } else {
                    alert('স্টক পর্যাপ্ত নেই!');
                    return;
                }
                
                // নতুন বিক্রয় যোগ
                const transactions = data.transactions;
                const transactionId = 'TRN_' + Date.now();
                transactions.push({
                    id: transactionId,
                    customerId: customerId,
                    productId: productId,
                    quantity: quantity,
                    unitPrice: unitPrice,
                    purchasePrice: purchasePrice,
                    profitLoss: profitLoss,
                    totalAmount: totalAmount,
                    paidAmount: paidAmount,
                    dueAmount: dueAmount,
                    date: date,
                    type: 'sale',
                    serial: dataManager.getNextSerial('transactions')
                });
                data.transactions = transactions;
                
                alert('বিক্রয় সফলভাবে সম্পন্ন হয়েছে!');
            }
            
            dataManager.saveAllData(data);
            
            // ফর্ম রিসেট
            resetTransactionForm();
            
            // তালিকা আপডেট
            loadProducts();
            loadTransactions();
            updateProductDropdown();
            updateProfitLossSummary();
            updateDataStatus();
        }

        // পুরানো বিক্রয় বাতিল (স্টক ফেরত)
        function cancelOldTransaction(transaction, data) {
            const productIndex = data.products.findIndex(product => product.id === transaction.productId);
            if (productIndex !== -1) {
                data.products[productIndex].stock += transaction.quantity;
                data.products[productIndex].totalSold -= transaction.quantity;
                
                if (data.products[productIndex].totalSold < 0) {
                    data.products[productIndex].totalSold = 0;
                }
            }
        }

        // বিক্রয় ফর্ম রিসেট
        function resetTransactionForm() {
            document.getElementById('addTransactionForm').reset();
            document.getElementById('updateTransactionBtn').style.display = 'none';
            document.getElementById('cancelTransactionEditBtn').style.display = 'none';
            document.getElementById('addTransactionBtn').style.display = 'block';
            document.getElementById('addTransactionBtn').textContent = 'বিক্রয় সম্পন্ন করুন';
            document.getElementById('transactionUnitPrice').value = '';
            document.getElementById('totalAmountDisplay').textContent = 'মোট মূল্য: 0 টাকা';
            document.getElementById('dueAmountDisplay').textContent = 'বাকি/অতিরিক্ত জমা: 0 টাকা';
            document.getElementById('noPayment').checked = false;
            document.getElementById('paidAmount').disabled = false;
            document.getElementById('productStockInfo').style.display = 'none';
            document.getElementById('dueStatus').textContent = '';
            setCurrentDate();
            updateProductDropdown();
            dataManager.clearEditingData('transaction');
        }

        // বিক্রয় এডিট ফাংশন
        function editTransaction(transactionId) {
            const data = dataManager.loadData();
            const transaction = data.transactions.find(t => t.id === transactionId);
            
            if (!transaction) return;
            
            document.getElementById('transactionCustomerId').value = transaction.customerId;
            document.getElementById('transactionProductId').value = transaction.productId;
            document.getElementById('transactionQuantity').value = transaction.quantity;
            document.getElementById('transactionUnitPrice').value = transaction.unitPrice;
            document.getElementById('paidAmount').value = transaction.paidAmount;
            document.getElementById('transactionDate').value = transaction.date;
            
            // পণ্য তথ্য আপডেট
            updateProductInfo();
            calculateTotalAmount();
            
            document.getElementById('updateTransactionBtn').style.display = 'block';
            document.getElementById('cancelTransactionEditBtn').style.display = 'block';
            document.getElementById('addTransactionBtn').style.display = 'none';
            document.getElementById('updateTransactionBtn').textContent = 'বিক্রয় আপডেট করুন';
            
            // এডিটিং ডেটা সংরক্ষণ
            dataManager.setEditingData('transaction', transaction);
        }

        // বিক্রয় এডিট বাতিল
        document.getElementById('cancelTransactionEditBtn').addEventListener('click', function() {
            resetTransactionForm();
        });

        // বিক্রয় ডিলিট ফাংশন
        function deleteTransaction(transactionId) {
            if (confirm('আপনি কি এই বিক্রয় ডিলিট করতে চান? স্টক ফেরত দেওয়া হবে!')) {
                const data = dataManager.loadData();
                const transactionIndex = data.transactions.findIndex(t => t.id === transactionId);
                
                if (transactionIndex === -1) return;
                
                const transaction = data.transactions[transactionIndex];
                
                // স্টক ফেরত দিন
                if (transaction) {
                    const productIndex = data.products.findIndex(product => product.id === transaction.productId);
                    
                    if (productIndex !== -1) {
                        data.products[productIndex].stock += transaction.quantity;
                        data.products[productIndex].totalSold -= transaction.quantity;
                        
                        if (data.products[productIndex].totalSold < 0) {
                            data.products[productIndex].totalSold = 0;
                        }
                    }
                }
                
                data.transactions.splice(transactionIndex, 1);
                dataManager.saveAllData(data);
                loadTransactions();
                loadProducts();
                updateProductDropdown();
                updateProfitLossSummary();
                updateDataStatus();
                
                alert('বিক্রয় সফলভাবে ডিলিট করা হয়েছে!');
            }
        }

        // ============================================
        // ডেটা লোড এবং ডিসপ্লে ফাংশন
        // ============================================
        // পণ্যের তালিকা লোড করা
        function loadProducts() {
            const data = dataManager.loadData();
            const products = data.products;
            const productsList = document.getElementById('productsList');
            productsList.innerHTML = '';
            
            let totalProducts = 0;
            let totalStockQuantity = 0;
            let totalStockValue = 0;
            let lowStockProducts = 0;
            
            products.forEach((product) => {
                const stockValue = product.stock * product.purchasePrice;
                const stockStatus = getStockStatus(product.stock);
                
                totalProducts++;
                totalStockQuantity += product.stock;
                totalStockValue += stockValue;
                
                if (product.stock <= 10) {
                    lowStockProducts++;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${formatNumber(product.purchasePrice)} টাকা</td>
                    <td>${formatNumber(product.sellingPrice || (product.purchasePrice * 1.2))} টাকা</td>
                    <td>${product.stock}</td>
                    <td class="${stockStatus.class}">${stockStatus.text}</td>
                    <td>${product.totalPurchased || 0}</td>
                    <td>${product.totalSold || 0}</td>
                    <td>${formatNumber(stockValue)} টাকা</td>
                    <td>${product.category || '-'}</td>
                    <td>
                        <button class="edit-btn" onclick="editProduct('${product.id}')">এডিট</button>
                        <button class="delete-btn" onclick="deleteProduct('${product.id}')">ডিলিট</button>
                    </td>
                `;
                productsList.appendChild(row);
            });
            
            // সারাংশ আপডেট
            document.getElementById('totalProducts').textContent = `${totalProducts} টি`;
            document.getElementById('totalStockQuantity').textContent = totalStockQuantity;
            document.getElementById('totalStockValue').textContent = `${formatNumber(totalStockValue)} টাকা`;
            document.getElementById('lowStockProducts').textContent = `${lowStockProducts} টি`;
        }

        // স্টক স্ট্যাটাস নির্ধারণ
        function getStockStatus(stock) {
            if (stock === 0) {
                return { class: 'stock-low', text: 'স্টক নেই' };
            } else if (stock <= 10) {
                return { class: 'stock-low', text: 'নিম্ন স্টক' };
            } else if (stock <= 25) {
                return { class: 'stock-medium', text: 'মধ্যম স্টক' };
            } else {
                return { class: 'stock-high', text: 'পর্যাপ্ত স্টক' };
            }
        }

        // লাভ-ক্ষতি সারাংশ আপডেট
        function updateProfitLossSummary() {
            const data = dataManager.loadData();
            const transactions = data.transactions;
            const purchases = data.purchases;
            const deposits = data.deposits || [];
            const commissionRate = data.commissionRate || 0;
            
            let totalPurchaseValue = 0;
            let totalSalesValue = 0;
            let totalCommission = 0;
            let totalProfitLoss = 0;
            let totalDirectDeposit = 0;
            
            // মোট ক্রয় মূল্য হিসাব
            purchases.forEach(purchase => {
                totalPurchaseValue += purchase.totalAmount || 0;
            });
            
            // মোট বিক্রয় মূল্য ও লাভ-ক্ষতি হিসাব
            transactions.forEach(transaction => {
                totalSalesValue += transaction.totalAmount || 0;
                totalCommission += (transaction.quantity || 0) * commissionRate;
                totalProfitLoss += transaction.profitLoss || 0;
            });
            
            // মোট সরাসরি জমা
            deposits.forEach(deposit => {
                totalDirectDeposit += deposit.amount || 0;
            });
            
            // লাভ-ক্ষতি শতাংশ
            const profitLossPercentage = totalPurchaseValue > 0 ? 
                ((totalProfitLoss / totalPurchaseValue) * 100).toFixed(2) : 0;
            
            // UI আপডেট
            document.getElementById('totalPurchaseValue').textContent = `${formatNumber(totalPurchaseValue)} টাকা`;
            document.getElementById('totalSalesValue').textContent = `${formatNumber(totalSalesValue)} টাকা`;
            document.getElementById('totalCommissionValue').textContent = `${formatNumber(totalCommission)} টাকা`;
            document.getElementById('totalDirectDeposit').textContent = `${formatNumber(totalDirectDeposit)} টাকা`;
            
            const profitLossElement = document.getElementById('totalProfitLoss');
            profitLossElement.textContent = `${formatNumber(totalProfitLoss)} টাকা`;
            
            // রঙ নির্ধারণ
            if (totalProfitLoss > 0) {
                profitLossElement.className = 'profit-positive';
            } else if (totalProfitLoss < 0) {
                profitLossElement.className = 'profit-negative';
            } else {
                profitLossElement.className = 'profit-neutral';
            }
            
            document.getElementById('profitLossPercentage').textContent = `${profitLossPercentage}%`;
        }

        // ক্রেতাদের তালিকা লোড করা
        function loadCustomers() {
            const data = dataManager.loadData();
            const customers = data.customers;
            const customersList = document.getElementById('customersList');
            customersList.innerHTML = '';
            
            customers.forEach((customer) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.id}</td>
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.address}</td>
                    <td>
                        <button class="edit-btn" onclick="editCustomer('${customer.id}')">এডিট</button>
                        <button class="delete-btn" onclick="deleteCustomer('${customer.id}')">ডিলিট</button>
                    </td>
                `;
                customersList.appendChild(row);
            });
        }

        // বিক্রয়ের তালিকা লোড করা
        function loadTransactions() {
            const data = dataManager.loadData();
            const transactions = data.transactions;
            const transactionsList = document.getElementById('transactionsList');
            transactionsList.innerHTML = '';
            
            // সিরিয়াল অনুযায়ী সাজান (পুরানো থেকে নতুন)
            transactions.sort((a, b) => (a.serial || 0) - (b.serial || 0));
            
            transactions.forEach((transaction) => {
                const profitLossClass = transaction.profitLoss > 0 ? 'profit-positive' : 
                                      transaction.profitLoss < 0 ? 'profit-negative' : 'profit-neutral';
                
                const dueClass = transaction.dueAmount > 0 ? 'due-negative' : 
                               transaction.dueAmount < 0 ? 'due-positive' : '';
                
                const dueText = transaction.dueAmount > 0 ? 
                    `<span class="due-negative">${formatNumber(transaction.dueAmount)} টাকা</span>` :
                    transaction.dueAmount < 0 ? 
                    `<span class="due-positive">${formatNumber(Math.abs(transaction.dueAmount))} টাকা (অতিরিক্ত)</span>` :
                    `<span class="due-positive">পরিশোধিত</span>`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transaction.serial}</td>
                    <td>${transaction.date}</td>
                    <td>${transaction.customerId}</td>
                    <td>${getProductName(transaction.productId)}</td>
                    <td>${transaction.quantity}</td>
                    <td>${formatNumber(transaction.purchasePrice)} টাকা</td>
                    <td>${formatNumber(transaction.unitPrice)} টাকা</td>
                    <td class="${profitLossClass}">${formatNumber(transaction.profitLoss)} টাকা</td>
                    <td>${formatNumber(transaction.totalAmount)} টাকা</td>
                    <td>${formatNumber(transaction.paidAmount)} টাকা</td>
                    <td class="${dueClass}">${dueText}</td>
                    <td>
                        <button class="edit-btn" onclick="editTransaction('${transaction.id}')">এডিট</button>
                        <button class="delete-btn" onclick="deleteTransaction('${transaction.id}')">ডিলিট</button>
                    </td>
                `;
                transactionsList.appendChild(row);
            });
        }

        // ক্রয়ের তালিকা লোড করা
        function loadPurchases() {
            const data = dataManager.loadData();
            const purchases = data.purchases;
            const purchasesList = document.getElementById('purchasesList');
            purchasesList.innerHTML = '';
            
            // সিরিয়াল অনুযায়ী সাজান (পুরানো থেকে নতুন)
            purchases.sort((a, b) => (a.serial || 0) - (b.serial || 0));
            
            purchases.forEach((purchase) => {
                const dueClass = purchase.dueAmount > 0 ? 'due-negative' : 
                               purchase.dueAmount < 0 ? 'due-positive' : '';
                
                const dueText = purchase.dueAmount > 0 ? 
                    `<span class="due-negative">${formatNumber(purchase.dueAmount)} টাকা</span>` :
                    purchase.dueAmount < 0 ? 
                    `<span class="due-positive">${formatNumber(Math.abs(purchase.dueAmount))} টাকা (অতিরিক্ত)</span>` :
                    `<span class="due-positive">পরিশোধিত</span>`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${purchase.serial}</td>
                    <td>${purchase.date}</td>
                    <td>${purchase.productId}</td>
                    <td>${purchase.productName}</td>
                    <td>${purchase.supplier}</td>
                    <td>${purchase.quantity}</td>
                    <td>${formatNumber(purchase.purchasePrice)} টাকা</td>
                    <td>${formatNumber(purchase.totalAmount)} টাকা</td>
                    <td>${formatNumber(purchase.paidAmount)} টাকা</td>
                    <td class="${dueClass}">${dueText}</td>
                    <td>
                        <button class="edit-btn" onclick="editPurchase('${purchase.id}')">এডিট</button>
                        <button class="delete-btn" onclick="deletePurchase('${purchase.id}')">ডিলিট</button>
                    </td>
                `;
                purchasesList.appendChild(row);
            });
        }

        // পণ্য আইডি থেকে পণ্যের নাম পাওয়া
        function getProductName(productId) {
            const data = dataManager.loadData();
            const product = data.products.find(p => p.id === productId);
            return product ? product.name : productId;
        }

        // ক্রেতা আইডি থেকে ক্রেতার নাম পাওয়া
        function getCustomerName(customerId) {
            const data = dataManager.loadData();
            const customer = data.customers.find(c => c.id === customerId);
            return customer ? customer.name : 'নাম পাওয়া যায়নি';
        }

        // পণ্য ড্রপডাউন আপডেট
        function updateProductDropdown() {
            const data = dataManager.loadData();
            const products = data.products;
            const productDropdown = document.getElementById('transactionProductId');
            
            // বর্তমান নির্বাচিত মান সংরক্ষণ
            const currentValue = productDropdown.value;
            
            // অপশনগুলি আপডেট
            productDropdown.innerHTML = '<option value="">পণ্য নির্বাচন করুন</option>';
            
            products.forEach(product => {
                if (product.stock > 0) {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = `${product.name} (ক্রয়: ${formatNumber(product.purchasePrice)} টাকা) - স্টক: ${product.stock}`;
                    productDropdown.appendChild(option);
                }
            });
            
            // পূর্বের নির্বাচিত মান পুনরায় সেট করুন
            if (currentValue) {
                productDropdown.value = currentValue;
            }
        }

        // ============================================
        // সংখ্যা ফরম্যাটিং ফাংশন
        // ============================================
        function formatNumber(num) {
            if (num === undefined || num === null || isNaN(num)) {
                return '0';
            }
            return parseFloat(num).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }

        // ============================================
        // স্টেটমেন্ট ও রিপোর্ট ব্যবস্থাপনা
        // ============================================
        // স্টেটমেন্ট অপশন পরিবর্তন
        document.getElementById('statementPeriod').addEventListener('change', function() {
            const customDateRange = document.getElementById('customDateRange');
            if (this.value === 'custom') {
                customDateRange.style.display = 'block';
            } else {
                customDateRange.style.display = 'none';
            }
        });

        // ক্রেতা স্টেটমেন্ট তৈরি
        document.getElementById('generateCustomerStatementBtn').addEventListener('click', function() {
            const customerId = document.getElementById('statementCustomerId').value;
            const period = document.getElementById('statementPeriod').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            const data = dataManager.loadData();
            let filteredTransactions = data.transactions;
            let filteredDeposits = data.deposits || [];
            
            // ক্রেতা আইডি অনুযায়ী ফিল্টার
            if (customerId) {
                filteredTransactions = filteredTransactions.filter(t => t.customerId === customerId);
                filteredDeposits = filteredDeposits.filter(d => d.customerId === customerId && d.type === 'customer');
            } else {
                filteredDeposits = filteredDeposits.filter(d => d.type === 'customer');
            }
            
            // তারিখ অনুযায়ী ফিল্টার
            filteredTransactions = filterByDate(filteredTransactions, period, startDate, endDate);
            filteredDeposits = filterByDate(filteredDeposits, period, startDate, endDate, 'deposit');
            
            // কমিশন রেট পাওয়া
            const commissionRate = data.commissionRate || 0;
            
            // ক্রেতার নাম পাওয়া
            const customerName = customerId ? getCustomerName(customerId) : 'সমস্ত ক্রেতা';
            
            // হিসাব করুন
            let totalSales = 0;
            let totalPaid = 0;
            let totalDue = 0;
            let totalCommission = 0;
            let totalDirectDeposit = 0;
            
            filteredTransactions.forEach(transaction => {
                totalSales += transaction.totalAmount || 0;
                totalPaid += transaction.paidAmount || 0;
                totalDue += transaction.dueAmount || 0;
                totalCommission += (transaction.quantity || 0) * commissionRate;
            });
            
            filteredDeposits.forEach(deposit => {
                totalDirectDeposit += deposit.amount || 0;
            });
            
            // মোট বাকি/অতিরিক্ত জমা = মোট বিক্রয় - (বিক্রয় জমা + সরাসরি জমা)
            const totalBalance = totalSales - (totalPaid + totalDirectDeposit);
            
            // স্টেটমেন্ট তৈরি
            let statementHTML = createStatementHeader('ক্রেতা বিক্রয় ও জমা বিবরণী');
            statementHTML += `
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #ddd;">
                    <p style="margin: 5px 0;"><strong>ক্রেতা:</strong> ${customerName} ${customerId ? '(আইডি: ' + customerId + ')' : ''}</p>
                    <p style="margin: 5px 0;"><strong>সময়কাল:</strong> ${getPeriodText(period, startDate, endDate)}</p>
                </div>
                
                <div class="summary-box" style="border: 2px solid #2a5298; background: linear-gradient(135deg, #f8f9fa, #e8f4f8); margin-bottom: 20px;">
                    <h4 style="text-align: center; margin-bottom: 15px; color: #2a5298; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">সারসংক্ষেপ</h4>
                    <div class="summary-item">
                        <span>মোট বিক্রয়:</span>
                        <span>${formatNumber(totalSales)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট জমা (বিক্রয় থেকে):</span>
                        <span>${formatNumber(totalPaid)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট সরাসরি জমা:</span>
                        <span>${formatNumber(totalDirectDeposit)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট জমা (সর্বমোট):</span>
                        <span>${formatNumber(totalPaid + totalDirectDeposit)} টাকা</span>
                    </div>
                    <div class="summary-item" style="${totalBalance > 0 ? 'color: #dc3545;' : totalBalance < 0 ? 'color: #28a745;' : ''}">
                        <span>মোট বাকি/অতিরিক্ত জমা:</span>
                        <span>${formatNumber(totalBalance)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট কমিশন:</span>
                        <span>${formatNumber(totalCommission)} টাকা</span>
                    </div>
                </div>
            `;
            
            if (filteredTransactions.length > 0) {
                statementHTML += `
                    <h4 style="color: #2a5298; margin-bottom: 15px; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">বিক্রয় লেনদেন</h4>
                    <table class="excel-table">
                        <thead>
                            <tr>
                                <th>সিরিয়াল</th>
                                <th>তারিখ</th>
                                <th>ক্রেতা আইডি</th>
                                <th>ক্রেতার নাম</th>
                                <th>পণ্য</th>
                                <th>পরিমাণ</th>
                                <th>মোট মূল্য</th>
                                <th>জমা</th>
                                <th>বাকি/অতিরিক্ত</th>
                                <th>কমিশন</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                filteredTransactions.forEach(transaction => {
                    const commission = transaction.quantity * commissionRate;
                    const dueClass = transaction.dueAmount > 0 ? 'due-negative' : 
                                   transaction.dueAmount < 0 ? 'due-positive' : '';
                    const dueText = transaction.dueAmount > 0 ? 
                        `<span class="due-negative">${formatNumber(transaction.dueAmount)} টাকা</span>` :
                        transaction.dueAmount < 0 ? 
                        `<span class="due-positive">${formatNumber(Math.abs(transaction.dueAmount))} টাকা (অতিরিক্ত)</span>` :
                        `<span class="due-positive">পরিশোধিত</span>`;
                    
                    statementHTML += `
                        <tr>
                            <td>${transaction.serial}</td>
                            <td>${transaction.date}</td>
                            <td>${transaction.customerId}</td>
                            <td>${getCustomerName(transaction.customerId)}</td>
                            <td>${getProductName(transaction.productId)}</td>
                            <td>${transaction.quantity}</td>
                            <td>${formatNumber(transaction.totalAmount)} টাকা</td>
                            <td>${formatNumber(transaction.paidAmount)} টাকা</td>
                            <td class="${dueClass}">${dueText}</td>
                            <td>${formatNumber(commission)} টাকা</td>
                        </tr>
                    `;
                });
                
                statementHTML += `
                        </tbody>
                    </table>
                `;
            }
            
            if (filteredDeposits.length > 0) {
                statementHTML += `
                    <h4 style="color: #2a5298; margin-top: 20px; margin-bottom: 15px; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">সরাসরি জমা লেনদেন</h4>
                    <table class="excel-table">
                        <thead>
                            <tr>
                                <th>সিরিয়াল</th>
                                <th>তারিখ</th>
                                <th>ক্রেতা আইডি</th>
                                <th>ক্রেতার নাম</th>
                                <th>জমা পরিমাণ</th>
                                <th>মন্তব্য</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                filteredDeposits.forEach(deposit => {
                    statementHTML += `
                        <tr>
                            <td>${deposit.serial}</td>
                            <td>${deposit.date}</td>
                            <td>${deposit.customerId}</td>
                            <td>${getCustomerName(deposit.customerId)}</td>
                            <td>${formatNumber(deposit.amount)} টাকা</td>
                            <td>${deposit.notes || '-'}</td>
                        </tr>
                    `;
                });
                
                statementHTML += `
                        </tbody>
                    </table>
                `;
            }
            
            statementHTML += `
            </div>
            `;
            
            document.getElementById('statementResult').innerHTML = statementHTML;
            showStatementActions();
        });

        // পণ্য ক্রয় স্টেটমেন্ট তৈরি - সরাসরি জমা সংযুক্ত
        document.getElementById('generatePurchaseStatementBtn').addEventListener('click', function() {
            const period = document.getElementById('statementPeriod').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            const data = dataManager.loadData();
            let filteredPurchases = filterByDate(data.purchases, period, startDate, endDate, 'purchase');
            let filteredDeposits = filterByDate(data.deposits || [], period, startDate, endDate, 'deposit');
            filteredDeposits = filteredDeposits.filter(d => d.type === 'supplier');
            
            // প্রতিটি সাপ্লায়ারের জন্য তথ্য সংগ্রহ
            const supplierData = {};
            
            // ক্রয় ডেটা প্রক্রিয়া
            filteredPurchases.forEach(purchase => {
                const supplier = purchase.supplier || 'অজানা সাপ্লাইয়ার';
                if (!supplierData[supplier]) {
                    supplierData[supplier] = {
                        purchases: [],
                        deposits: [],
                        totalPurchaseAmount: 0,
                        totalPaidAmount: 0,
                        totalDueAmount: 0,
                        totalDepositAmount: 0
                    };
                }
                
                supplierData[supplier].purchases.push(purchase);
                supplierData[supplier].totalPurchaseAmount += purchase.totalAmount || 0;
                supplierData[supplier].totalPaidAmount += purchase.paidAmount || 0;
                supplierData[supplier].totalDueAmount += purchase.dueAmount || 0;
            });
            
            // সরাসরি জমা ডেটা প্রক্রিয়া
            filteredDeposits.forEach(deposit => {
                const supplier = deposit.supplier || 'অজানা সাপ্লাইয়ার';
                if (!supplierData[supplier]) {
                    supplierData[supplier] = {
                        purchases: [],
                        deposits: [],
                        totalPurchaseAmount: 0,
                        totalPaidAmount: 0,
                        totalDueAmount: 0,
                        totalDepositAmount: 0
                    };
                }
                
                supplierData[supplier].deposits.push(deposit);
                supplierData[supplier].totalDepositAmount += deposit.amount || 0;
            });
            
            // সামগ্রিক হিসাব
            let totalPurchases = 0;
            let totalAmount = 0;
            let totalPaid = 0;
            let totalDue = 0;
            let totalDirectDeposit = 0;
            
            filteredPurchases.forEach(purchase => {
                totalPurchases++;
                totalAmount += purchase.totalAmount || 0;
                totalPaid += purchase.paidAmount || 0;
                totalDue += purchase.dueAmount || 0;
            });
            
            filteredDeposits.forEach(deposit => {
                totalDirectDeposit += deposit.amount || 0;
            });
            
            // মোট বাকি/অতিরিক্ত জমা = মোট ক্রয় - (ক্রয় জমা + সরাসরি জমা)
            const totalBalance = totalAmount - (totalPaid + totalDirectDeposit);
            
            // স্টেটমেন্ট তৈরি
            let statementHTML = createStatementHeader('পণ্য ক্রয় বিবরণী (সাপ্লায়ার অনুযায়ী)');
            statementHTML += `
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #ddd;">
                    <p style="margin: 5px 0;"><strong>সময়কাল:</strong> ${getPeriodText(period, startDate, endDate)}</p>
                </div>
                
                <div class="summary-box" style="border: 2px solid #2a5298; background: linear-gradient(135deg, #f8f9fa, #e8f4f8); margin-bottom: 20px;">
                    <h4 style="text-align: center; margin-bottom: 15px; color: #2a5298; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">সারসংক্ষেপ</h4>
                    <div class="summary-item">
                        <span>মোট ক্রয় সংখ্যা:</span>
                        <span>${totalPurchases} টি</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট ক্রয় মূল্য:</span>
                        <span>${formatNumber(totalAmount)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট জমা (ক্রয় থেকে):</span>
                        <span>${formatNumber(totalPaid)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট সরাসরি জমা:</span>
                        <span>${formatNumber(totalDirectDeposit)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট জমা (সর্বমোট):</span>
                        <span>${formatNumber(totalPaid + totalDirectDeposit)} টাকা</span>
                    </div>
                    <div class="summary-item" style="${totalBalance > 0 ? 'color: #dc3545;' : totalBalance < 0 ? 'color: #28a745;' : ''}">
                        <span>মোট বাকি/অতিরিক্ত জমা:</span>
                        <span>${formatNumber(totalBalance)} টাকা</span>
                    </div>
                </div>
            `;
            
            // প্রতিটি সাপ্লায়ারের জন্য আলাদা সেকশন
            Object.keys(supplierData).forEach(supplier => {
                const data = supplierData[supplier];
                const supplierBalance = data.totalPurchaseAmount - (data.totalPaidAmount + data.totalDepositAmount);
                
                statementHTML += `
                    <div style="margin: 20px 0; padding: 15px; background: #f0f8ff; border-radius: 8px; border: 1px solid #cce5ff;">
                        <h4 style="color: #2a5298; margin-bottom: 10px; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">
                            সাপ্লাইয়ার: ${supplier}
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <div style="padding: 10px; background: white; border-radius: 5px;">
                                <strong>মোট ক্রয়:</strong> ${formatNumber(data.totalPurchaseAmount)} টাকা
                            </div>
                            <div style="padding: 10px; background: white; border-radius: 5px;">
                                <strong>ক্রয় জমা:</strong> ${formatNumber(data.totalPaidAmount)} টাকা
                            </div>
                            <div style="padding: 10px; background: white; border-radius: 5px;">
                                <strong>সরাসরি জমা:</strong> ${formatNumber(data.totalDepositAmount)} টাকা
                            </div>
                            <div style="padding: 10px; background: white; border-radius: 5px; ${supplierBalance > 0 ? 'color: #dc3545;' : supplierBalance < 0 ? 'color: #28a745;' : ''}">
                                <strong>বাকি/অতিরিক্ত:</strong> ${formatNumber(supplierBalance)} টাকা
                            </div>
                        </div>
                `;
                
                if (data.purchases.length > 0) {
                    statementHTML += `
                        <h5 style="color: #2a5298; margin-bottom: 10px;">ক্রয় লেনদেন</h5>
                        <table class="excel-table" style="font-size: 12px;">
                            <thead>
                                <tr>
                                    <th>সিরিয়াল</th>
                                    <th>তারিখ</th>
                                    <th>পণ্য আইডি</th>
                                    <th>পণ্যের নাম</th>
                                    <th>পরিমাণ</th>
                                    <th>ক্রয় মূল্য</th>
                                    <th>মোট মূল্য</th>
                                    <th>জমা</th>
                                    <th>বাকি/অতিরিক্ত</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    data.purchases.forEach(purchase => {
                        const dueClass = purchase.dueAmount > 0 ? 'due-negative' : 
                                       purchase.dueAmount < 0 ? 'due-positive' : '';
                        const dueText = purchase.dueAmount > 0 ? 
                            `<span class="due-negative">${formatNumber(purchase.dueAmount)} টাকা</span>` :
                            purchase.dueAmount < 0 ? 
                            `<span class="due-positive">${formatNumber(Math.abs(purchase.dueAmount))} টাকা (অতিরিক্ত)</span>` :
                            `<span class="due-positive">পরিশোধিত</span>`;
                        
                        statementHTML += `
                            <tr>
                                <td>${purchase.serial}</td>
                                <td>${purchase.date}</td>
                                <td>${purchase.productId}</td>
                                <td>${purchase.productName}</td>
                                <td>${purchase.quantity}</td>
                                <td>${formatNumber(purchase.purchasePrice)} টাকা</td>
                                <td>${formatNumber(purchase.totalAmount)} টাকা</td>
                                <td>${formatNumber(purchase.paidAmount)} টাকা</td>
                                <td class="${dueClass}">${dueText}</td>
                            </tr>
                        `;
                    });
                    
                    statementHTML += `
                            </tbody>
                        </table>
                    `;
                }
                
                if (data.deposits.length > 0) {
                    statementHTML += `
                        <h5 style="color: #2a5298; margin-top: 15px; margin-bottom: 10px;">সরাসরি জমা লেনদেন</h5>
                        <table class="excel-table" style="font-size: 12px;">
                            <thead>
                                <tr>
                                    <th>সিরিয়াল</th>
                                    <th>তারিখ</th>
                                    <th>জমা পরিমাণ</th>
                                    <th>মন্তব্য</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    data.deposits.forEach(deposit => {
                        statementHTML += `
                            <tr>
                                <td>${deposit.serial}</td>
                                <td>${deposit.date}</td>
                                <td>${formatNumber(deposit.amount)} টাকা</td>
                                <td>${deposit.notes || '-'}</td>
                            </tr>
                        `;
                    });
                    
                    statementHTML += `
                            </tbody>
                        </table>
                    `;
                }
                
                statementHTML += `</div>`;
            });
            
            statementHTML += `
            </div>
            `;
            
            document.getElementById('statementResult').innerHTML = statementHTML;
            showStatementActions();
        });

        // পণ্য বিক্রয় স্টেটমেন্ট তৈরি - সরাসরি জমা সংযুক্ত
        document.getElementById('generateProductStatementBtn').addEventListener('click', function() {
            const period = document.getElementById('statementPeriod').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            const data = dataManager.loadData();
            let filteredTransactions = filterByDate(data.transactions, period, startDate, endDate);
            let filteredDeposits = filterByDate(data.deposits || [], period, startDate, endDate, 'deposit');
            filteredDeposits = filteredDeposits.filter(d => d.type === 'customer');
            
            // প্রতিটি পণ্যের জন্য তথ্য সংগ্রহ
            const productData = {};
            
            // বিক্রয় ডেটা প্রক্রিয়া
            filteredTransactions.forEach(transaction => {
                const productId = transaction.productId;
                const productName = getProductName(productId);
                const key = `${productId} - ${productName}`;
                
                if (!productData[key]) {
                    productData[key] = {
                        productId: productId,
                        productName: productName,
                        transactions: [],
                        deposits: [],
                        totalQuantity: 0,
                        totalSalesAmount: 0,
                        totalPaidAmount: 0,
                        totalDueAmount: 0,
                        totalProfitLoss: 0,
                        totalDepositAmount: 0
                    };
                }
                
                productData[key].transactions.push(transaction);
                productData[key].totalQuantity += transaction.quantity || 0;
                productData[key].totalSalesAmount += transaction.totalAmount || 0;
                productData[key].totalPaidAmount += transaction.paidAmount || 0;
                productData[key].totalDueAmount += transaction.dueAmount || 0;
                productData[key].totalProfitLoss += transaction.profitLoss || 0;
            });
            
            // সরাসরি জমা ডেটা প্রক্রিয়া (ক্রেতা অনুযায়ী)
            const customerDeposits = {};
            filteredDeposits.forEach(deposit => {
                const customerId = deposit.customerId;
                if (!customerDeposits[customerId]) {
                    customerDeposits[customerId] = [];
                }
                customerDeposits[customerId].push(deposit);
            });
            
            // কমিশন রেট পাওয়া
            const commissionRate = data.commissionRate || 0;
            
            // সামগ্রিক হিসাব
            let totalSales = 0;
            let totalPaid = 0;
            let totalDue = 0;
            let totalProfitLoss = 0;
            let totalCommission = 0;
            let totalDirectDeposit = 0;
            
            filteredTransactions.forEach(transaction => {
                totalSales += transaction.totalAmount || 0;
                totalPaid += transaction.paidAmount || 0;
                totalDue += transaction.dueAmount || 0;
                totalProfitLoss += transaction.profitLoss || 0;
                totalCommission += (transaction.quantity || 0) * commissionRate;
            });
            
            filteredDeposits.forEach(deposit => {
                totalDirectDeposit += deposit.amount || 0;
            });
            
            // মোট বাকি/অতিরিক্ত জমা
            const totalBalance = totalSales - (totalPaid + totalDirectDeposit);
            
            // স্টেটমেন্ট তৈরি
            let statementHTML = createStatementHeader('পণ্য বিক্রয় বিবরণী');
            statementHTML += `
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #ddd;">
                    <p style="margin: 5px 0;"><strong>সময়কাল:</strong> ${getPeriodText(period, startDate, endDate)}</p>
                </div>
                
                <div class="summary-box" style="border: 2px solid #2a5298; background: linear-gradient(135deg, #f8f9fa, #e8f4f8); margin-bottom: 20px;">
                    <h4 style="text-align: center; margin-bottom: 15px; color: #2a5298; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">সারসংক্ষেপ</h4>
                    <div class="summary-item">
                        <span>মোট বিক্রয়:</span>
                        <span>${formatNumber(totalSales)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট জমা (বিক্রয় থেকে):</span>
                        <span>${formatNumber(totalPaid)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট সরাসরি জমা:</span>
                        <span>${formatNumber(totalDirectDeposit)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট জমা (সর্বমোট):</span>
                        <span>${formatNumber(totalPaid + totalDirectDeposit)} টাকা</span>
                    </div>
                    <div class="summary-item" style="${totalBalance > 0 ? 'color: #dc3545;' : totalBalance < 0 ? 'color: #28a745;' : ''}">
                        <span>মোট বাকি/অতিরিক্ত জমা:</span>
                        <span>${formatNumber(totalBalance)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট লাভ/ক্ষতি:</span>
                        <span style="${totalProfitLoss > 0 ? 'color: #28a745;' : totalProfitLoss < 0 ? 'color: #dc3545;' : ''}">${formatNumber(totalProfitLoss)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>মোট কমিশন:</span>
                        <span>${formatNumber(totalCommission)} টাকা</span>
                    </div>
                </div>
            `;
            
            // প্রতিটি পণ্যের জন্য আলাদা সেকশন
            Object.keys(productData).forEach(key => {
                const data = productData[key];
                const productBalance = data.totalSalesAmount - (data.totalPaidAmount + getCustomerDepositsForProduct(data.transactions, customerDeposits));
                
                statementHTML += `
                    <div style="margin: 20px 0; padding: 15px; background: #f0f8ff; border-radius: 8px; border: 1px solid #cce5ff;">
                        <h4 style="color: #2a5298; margin-bottom: 10px; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">
                            পণ্য: ${data.productName} (আইডি: ${data.productId})
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <div style="padding: 10px; background: white; border-radius: 5px;">
                                <strong>মোট বিক্রয় পরিমাণ:</strong> ${data.totalQuantity}
                            </div>
                            <div style="padding: 10px; background: white; border-radius: 5px;">
                                <strong>মোট বিক্রয় মূল্য:</strong> ${formatNumber(data.totalSalesAmount)} টাকা
                            </div>
                            <div style="padding: 10px; background: white; border-radius: 5px;">
                                <strong>বিক্রয় জমা:</strong> ${formatNumber(data.totalPaidAmount)} টাকা
                            </div>
                            <div style="padding: 10px; background: white; border-radius: 5px; ${productBalance > 0 ? 'color: #dc3545;' : productBalance < 0 ? 'color: #28a745;' : ''}">
                                <strong>বাকি/অতিরিক্ত:</strong> ${formatNumber(productBalance)} টাকা
                            </div>
                        </div>
                `;
                
                if (data.transactions.length > 0) {
                    statementHTML += `
                        <h5 style="color: #2a5298; margin-bottom: 10px;">বিক্রয় লেনদেন</h5>
                        <table class="excel-table" style="font-size: 12px;">
                            <thead>
                                <tr>
                                    <th>সিরিয়াল</th>
                                    <th>তারিখ</th>
                                    <th>ক্রেতা আইডি</th>
                                    <th>ক্রেতার নাম</th>
                                    <th>পরিমাণ</th>
                                    <th>বিক্রয় মূল্য</th>
                                    <th>মোট মূল্য</th>
                                    <th>জমা</th>
                                    <th>বাকি/অতিরিক্ত</th>
                                    <th>লাভ/ক্ষতি</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    data.transactions.forEach(transaction => {
                        const dueClass = transaction.dueAmount > 0 ? 'due-negative' : 
                                       transaction.dueAmount < 0 ? 'due-positive' : '';
                        const dueText = transaction.dueAmount > 0 ? 
                            `<span class="due-negative">${formatNumber(transaction.dueAmount)} টাকা</span>` :
                            transaction.dueAmount < 0 ? 
                            `<span class="due-positive">${formatNumber(Math.abs(transaction.dueAmount))} টাকা (অতিরিক্ত)</span>` :
                            `<span class="due-positive">পরিশোধিত</span>`;
                        
                        const profitClass = transaction.profitLoss > 0 ? 'profit-positive' : 
                                          transaction.profitLoss < 0 ? 'profit-negative' : 'profit-neutral';
                        
                        statementHTML += `
                            <tr>
                                <td>${transaction.serial}</td>
                                <td>${transaction.date}</td>
                                <td>${transaction.customerId}</td>
                                <td>${getCustomerName(transaction.customerId)}</td>
                                <td>${transaction.quantity}</td>
                                <td>${formatNumber(transaction.unitPrice)} টাকা</td>
                                <td>${formatNumber(transaction.totalAmount)} টাকা</td>
                                <td>${formatNumber(transaction.paidAmount)} টাকা</td>
                                <td class="${dueClass}">${dueText}</td>
                                <td class="${profitClass}">${formatNumber(transaction.profitLoss)} টাকা</td>
                            </tr>
                        `;
                    });
                    
                    statementHTML += `
                            </tbody>
                        </table>
                    `;
                }
                
                statementHTML += `</div>`;
            });
            
            // সরাসরি জমা সেকশন (যদি থাকে)
            if (filteredDeposits.length > 0) {
                statementHTML += `
                    <div style="margin: 20px 0; padding: 15px; background: #f0fff0; border-radius: 8px; border: 1px solid #d4edda;">
                        <h4 style="color: #2a5298; margin-bottom: 15px; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">সরাসরি ক্রেতা জমা</h4>
                        <table class="excel-table">
                            <thead>
                                <tr>
                                    <th>সিরিয়াল</th>
                                    <th>তারিখ</th>
                                    <th>ক্রেতা আইডি</th>
                                    <th>ক্রেতার নাম</th>
                                    <th>জমা পরিমাণ</th>
                                    <th>মন্তব্য</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                filteredDeposits.forEach(deposit => {
                    statementHTML += `
                        <tr>
                            <td>${deposit.serial}</td>
                            <td>${deposit.date}</td>
                            <td>${deposit.customerId}</td>
                            <td>${getCustomerName(deposit.customerId)}</td>
                            <td>${formatNumber(deposit.amount)} টাকা</td>
                            <td>${deposit.notes || '-'}</td>
                        </tr>
                    `;
                });
                
                statementHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            statementHTML += `
            </div>
            `;
            
            document.getElementById('statementResult').innerHTML = statementHTML;
            showStatementActions();
        });

        // একটি পণ্যের ক্রেতাদের জন্য মোট সরাসরি জমা গণনা
        function getCustomerDepositsForProduct(transactions, customerDeposits) {
            let total = 0;
            const customerIds = [...new Set(transactions.map(t => t.customerId))];
            
            customerIds.forEach(customerId => {
                if (customerDeposits[customerId]) {
                    customerDeposits[customerId].forEach(deposit => {
                        total += deposit.amount || 0;
                    });
                }
            });
            
            return total;
        }

        // জমা বিবরণী তৈরি
        document.getElementById('generateDepositStatementBtn').addEventListener('click', function() {
            const period = document.getElementById('statementPeriod').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            const data = dataManager.loadData();
            let filteredDeposits = filterByDate(data.deposits || [], period, startDate, endDate, 'deposit');
            
            // ধরন অনুযায়ী গ্রুপ
            const depositTypes = {
                supplier: [],
                customer: [],
                other: []
            };
            
            filteredDeposits.forEach(deposit => {
                if (depositTypes[deposit.type]) {
                    depositTypes[deposit.type].push(deposit);
                } else {
                    depositTypes.other.push(deposit);
                }
            });
            
            // মোট হিসাব
            let totalSupplierDeposits = 0;
            let totalCustomerDeposits = 0;
            let totalOtherDeposits = 0;
            let totalAllDeposits = 0;
            
            depositTypes.supplier.forEach(d => totalSupplierDeposits += d.amount || 0);
            depositTypes.customer.forEach(d => totalCustomerDeposits += d.amount || 0);
            depositTypes.other.forEach(d => totalOtherDeposits += d.amount || 0);
            totalAllDeposits = totalSupplierDeposits + totalCustomerDeposits + totalOtherDeposits;
            
            // স্টেটমেন্ট তৈরি
            let statementHTML = createStatementHeader('সরাসরি জমা বিবরণী');
            statementHTML += `
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #ddd;">
                    <p style="margin: 5px 0;"><strong>সময়কাল:</strong> ${getPeriodText(period, startDate, endDate)}</p>
                </div>
                
                <div class="summary-box" style="border: 2px solid #2a5298; background: linear-gradient(135deg, #f8f9fa, #e8f4f8); margin-bottom: 20px;">
                    <h4 style="text-align: center; margin-bottom: 15px; color: #2a5298; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">সারসংক্ষেপ</h4>
                    <div class="summary-item">
                        <span>সাপ্লায়ার জমা:</span>
                        <span>${formatNumber(totalSupplierDeposits)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>ক্রেতা জমা:</span>
                        <span>${formatNumber(totalCustomerDeposits)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>অন্যান্য জমা:</span>
                        <span>${formatNumber(totalOtherDeposits)} টাকা</span>
                    </div>
                    <div class="summary-item" style="font-weight: bold; border-top: 2px solid #2a5298; padding-top: 10px;">
                        <span>মোট জমা:</span>
                        <span>${formatNumber(totalAllDeposits)} টাকা</span>
                    </div>
                </div>
            `;
            
            // সাপ্লায়ার জমা সেকশন
            if (depositTypes.supplier.length > 0) {
                statementHTML += `
                    <div style="margin: 20px 0;">
                        <h4 style="color: #2a5298; margin-bottom: 15px; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">সাপ্লায়ার জমা</h4>
                        <table class="excel-table">
                            <thead>
                                <tr>
                                    <th>সিরিয়াল</th>
                                    <th>তারিখ</th>
                                    <th>সাপ্লায়ার নাম</th>
                                    <th>জমা পরিমাণ</th>
                                    <th>মন্তব্য</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                depositTypes.supplier.forEach(deposit => {
                    statementHTML += `
                        <tr>
                            <td>${deposit.serial}</td>
                            <td>${deposit.date}</td>
                            <td>${deposit.supplier}</td>
                            <td>${formatNumber(deposit.amount)} টাকা</td>
                            <td>${deposit.notes || '-'}</td>
                        </tr>
                    `;
                });
                
                statementHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            // ক্রেতা জমা সেকশন
            if (depositTypes.customer.length > 0) {
                statementHTML += `
                    <div style="margin: 20px 0;">
                        <h4 style="color: #2a5298; margin-bottom: 15px; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">ক্রেতা জমা</h4>
                        <table class="excel-table">
                            <thead>
                                <tr>
                                    <th>সিরিয়াল</th>
                                    <th>তারিখ</th>
                                    <th>ক্রেতা আইডি</th>
                                    <th>ক্রেতার নাম</th>
                                    <th>জমা পরিমাণ</th>
                                    <th>মন্তব্য</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                depositTypes.customer.forEach(deposit => {
                    statementHTML += `
                        <tr>
                            <td>${deposit.serial}</td>
                            <td>${deposit.date}</td>
                            <td>${deposit.customerId}</td>
                            <td>${getCustomerName(deposit.customerId)}</td>
                            <td>${formatNumber(deposit.amount)} টাকা</td>
                            <td>${deposit.notes || '-'}</td>
                        </tr>
                    `;
                });
                
                statementHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            // অন্যান্য জমা সেকশন
            if (depositTypes.other.length > 0) {
                statementHTML += `
                    <div style="margin: 20px 0;">
                        <h4 style="color: #2a5298; margin-bottom: 15px; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">অন্যান্য জমা</h4>
                        <table class="excel-table">
                            <thead>
                                <tr>
                                    <th>সিরিয়াল</th>
                                    <th>তারিখ</th>
                                    <th>জমা ধরন</th>
                                    <th>জমা পরিমাণ</th>
                                    <th>মন্তব্য</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                depositTypes.other.forEach(deposit => {
                    statementHTML += `
                        <tr>
                            <td>${deposit.serial}</td>
                            <td>${deposit.date}</td>
                            <td>${deposit.type}</td>
                            <td>${formatNumber(deposit.amount)} টাকা</td>
                            <td>${deposit.notes || '-'}</td>
                        </tr>
                    `;
                });
                
                statementHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            statementHTML += `
            </div>
            `;
            
            document.getElementById('statementResult').innerHTML = statementHTML;
            showStatementActions();
        });

        // লাভ-ক্ষতি বিবরণী তৈরি
        document.getElementById('generateProfitLossStatementBtn').addEventListener('click', function() {
            const period = document.getElementById('statementPeriod').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            const data = dataManager.loadData();
            let filteredTransactions = filterByDate(data.transactions, period, startDate, endDate);
            let filteredPurchases = filterByDate(data.purchases, period, startDate, endDate, 'purchase');
            let filteredDeposits = filterByDate(data.deposits || [], period, startDate, endDate, 'deposit');
            
            const commissionRate = data.commissionRate || 0;
            
            // হিসাব
            let totalSales = 0;
            let totalPurchaseCost = 0;
            let totalPaidFromSales = 0;
            let totalDueFromSales = 0;
            let totalProfitLoss = 0;
            let totalCommission = 0;
            
            let totalPurchases = 0;
            let totalPurchaseAmount = 0;
            let totalPaidForPurchases = 0;
            let totalDueForPurchases = 0;
            
            let totalSupplierDeposits = 0;
            let totalCustomerDeposits = 0;
            let totalOtherDeposits = 0;
            
            // বিক্রয় হিসাব
            filteredTransactions.forEach(transaction => {
                totalSales += transaction.totalAmount || 0;
                totalPurchaseCost += (transaction.purchasePrice || 0) * (transaction.quantity || 0);
                totalPaidFromSales += transaction.paidAmount || 0;
                totalDueFromSales += transaction.dueAmount || 0;
                totalProfitLoss += transaction.profitLoss || 0;
                totalCommission += (transaction.quantity || 0) * commissionRate;
            });
            
            // ক্রয় হিসাব
            filteredPurchases.forEach(purchase => {
                totalPurchases++;
                totalPurchaseAmount += purchase.totalAmount || 0;
                totalPaidForPurchases += purchase.paidAmount || 0;
                totalDueForPurchases += purchase.dueAmount || 0;
            });
            
            // জমা হিসাব
            filteredDeposits.forEach(deposit => {
                if (deposit.type === 'supplier') {
                    totalSupplierDeposits += deposit.amount || 0;
                } else if (deposit.type === 'customer') {
                    totalCustomerDeposits += deposit.amount || 0;
                } else {
                    totalOtherDeposits += deposit.amount || 0;
                }
            });
            
            // নেট লাভ/ক্ষতি গণনা
            const netProfitLoss = totalProfitLoss - totalCommission;
            const profitLossPercentage = totalPurchaseCost > 0 ? 
                ((netProfitLoss / totalPurchaseCost) * 100).toFixed(2) : 0;
            
            // নগদ প্রবাহ বিশ্লেষণ
            const cashInflow = totalPaidFromSales + totalCustomerDeposits;
            const cashOutflow = totalPaidForPurchases + totalSupplierDeposits;
            const netCashFlow = cashInflow - cashOutflow;
            
            // স্টেটমেন্ট তৈরি
            let statementHTML = createStatementHeader('লাভ-ক্ষতি ও নগদ প্রবাহ বিবরণী');
            statementHTML += `
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #ddd;">
                    <p style="margin: 5px 0;"><strong>সময়কাল:</strong> ${getPeriodText(period, startDate, endDate)}</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="summary-box" style="border: 2px solid #2a5298; background: linear-gradient(135deg, #f8f9fa, #e8f4f8);">
                        <h4 style="text-align: center; margin-bottom: 15px; color: #2a5298; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">বিক্রয় সারাংশ</h4>
                        <div class="summary-item">
                            <span>মোট বিক্রয়:</span>
                            <span>${formatNumber(totalSales)} টাকা</span>
                        </div>
                        <div class="summary-item">
                            <span>ক্রয় মূল্য:</span>
                            <span>${formatNumber(totalPurchaseCost)} টাকা</span>
                        </div>
                        <div class="summary-item">
                            <span>মোট লাভ/ক্ষতি:</span>
                            <span style="${totalProfitLoss > 0 ? 'color: #28a745;' : totalProfitLoss < 0 ? 'color: #dc3545;' : ''}">${formatNumber(totalProfitLoss)} টাকা</span>
                        </div>
                        <div class="summary-item">
                            <span>মোট কমিশন:</span>
                            <span>${formatNumber(totalCommission)} টাকা</span>
                        </div>
                        <div class="summary-item" style="font-weight: bold; border-top: 2px solid #2a5298; padding-top: 10px;">
                            <span>নেট লাভ/ক্ষতি:</span>
                            <span style="${netProfitLoss > 0 ? 'color: #28a745;' : netProfitLoss < 0 ? 'color: #dc3545;' : ''}">${formatNumber(netProfitLoss)} টাকা (${profitLossPercentage}%)</span>
                        </div>
                    </div>
                    
                    <div class="summary-box" style="border: 2px solid #2a5298; background: linear-gradient(135deg, #f8f9fa, #e8f4f8);">
                        <h4 style="text-align: center; margin-bottom: 15px; color: #2a5298; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">ক্রয় সারাংশ</h4>
                        <div class="summary-item">
                            <span>মোট ক্রয় সংখ্যা:</span>
                            <span>${totalPurchases} টি</span>
                        </div>
                        <div class="summary-item">
                            <span>মোট ক্রয় মূল্য:</span>
                            <span>${formatNumber(totalPurchaseAmount)} টাকা</span>
                        </div>
                        <div class="summary-item">
                            <span>জমা দেওয়া:</span>
                            <span>${formatNumber(totalPaidForPurchases)} টাকা</span>
                        </div>
                        <div class="summary-item">
                            <span>বাকি আছে:</span>
                            <span style="${totalDueForPurchases > 0 ? 'color: #dc3545;' : 'color: #28a745;'}">${formatNumber(totalDueForPurchases)} টাকা</span>
                        </div>
                    </div>
                </div>
                
                <div class="summary-box" style="border: 2px solid #2a5298; background: linear-gradient(135deg, #f8f9fa, #e8f4f8); margin-bottom: 20px;">
                    <h4 style="text-align: center; margin-bottom: 15px; color: #2a5298; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">নগদ প্রবাহ বিশ্লেষণ</h4>
                    <div class="summary-item">
                        <span>নগদ প্রাপ্তি (বিক্রয়):</span>
                        <span>${formatNumber(totalPaidFromSales)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>নগদ প্রাপ্তি (ক্রেতা জমা):</span>
                        <span>${formatNumber(totalCustomerDeposits)} টাকা</span>
                    </div>
                    <div class="summary-item" style="font-weight: bold;">
                        <span>মোট নগদ প্রাপ্তি:</span>
                        <span>${formatNumber(cashInflow)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>নগদ পরিশোধ (ক্রয়):</span>
                        <span>${formatNumber(totalPaidForPurchases)} টাকা</span>
                    </div>
                    <div class="summary-item">
                        <span>নগদ পরিশোধ (সাপ্লায়ার জমা):</span>
                        <span>${formatNumber(totalSupplierDeposits)} টাকা</span>
                    </div>
                    <div class="summary-item" style="font-weight: bold;">
                        <span>মোট নগদ পরিশোধ:</span>
                        <span>${formatNumber(cashOutflow)} টাকা</span>
                    </div>
                    <div class="summary-item" style="font-weight: bold; border-top: 2px solid #2a5298; padding-top: 10px;">
                        <span>নেট নগদ প্রবাহ:</span>
                        <span style="${netCashFlow > 0 ? 'color: #28a745;' : netCashFlow < 0 ? 'color: #dc3545;' : ''}">${formatNumber(netCashFlow)} টাকা</span>
                    </div>
                </div>
            `;
            
            // বিস্তারিত লেনদেন সেকশন
            statementHTML += `
                <div style="margin: 20px 0;">
                    <h4 style="color: #2a5298; margin-bottom: 15px; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">বিক্রয় লেনদেন (উচ্চ লাভের প্রথম ১০টি)</h4>
            `;
            
            // উচ্চ লাভের লেনদেন সাজান
            const highProfitTransactions = [...filteredTransactions]
                .sort((a, b) => (b.profitLoss || 0) - (a.profitLoss || 0))
                .slice(0, 10);
            
            if (highProfitTransactions.length > 0) {
                statementHTML += `
                    <table class="excel-table">
                        <thead>
                            <tr>
                                <th>সিরিয়াল</th>
                                <th>তারিখ</th>
                                <th>ক্রেতা</th>
                                <th>পণ্য</th>
                                <th>পরিমাণ</th>
                                <th>ক্রয় মূল্য</th>
                                <th>বিক্রয় মূল্য</th>
                                <th>লাভ/ক্ষতি</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                highProfitTransactions.forEach(transaction => {
                    const profitClass = transaction.profitLoss > 0 ? 'profit-positive' : 
                                      transaction.profitLoss < 0 ? 'profit-negative' : 'profit-neutral';
                    
                    statementHTML += `
                        <tr>
                            <td>${transaction.serial}</td>
                            <td>${transaction.date}</td>
                            <td>${getCustomerName(transaction.customerId)}</td>
                            <td>${getProductName(transaction.productId)}</td>
                            <td>${transaction.quantity}</td>
                            <td>${formatNumber(transaction.purchasePrice)} টাকা</td>
                            <td>${formatNumber(transaction.unitPrice)} টাকা</td>
                            <td class="${profitClass}">${formatNumber(transaction.profitLoss)} টাকা</td>
                        </tr>
                    `;
                });
                
                statementHTML += `
                        </tbody>
                    </table>
                `;
            } else {
                statementHTML += `<p style="text-align: center; color: #666; padding: 20px;">কোনো লেনদেন পাওয়া যায়নি</p>`;
            }
            
            statementHTML += `</div></div>`;
            
            document.getElementById('statementResult').innerHTML = statementHTML;
            showStatementActions();
        });

        // তারিখ অনুযায়ী ফিল্টার ফাংশন
        function filterByDate(data, period, startDate, endDate, type = 'sale') {
            let filteredData = data;
            
            if (period === 'daily') {
                const today = new Date().toISOString().split('T')[0];
                filteredData = filteredData.filter(item => item.date === today);
            } else if (period === 'monthly') {
                const currentMonth = new Date().toISOString().substring(0, 7);
                filteredData = filteredData.filter(item => item.date.startsWith(currentMonth));
            } else if (period === 'yearly') {
                const currentYear = new Date().getFullYear();
                filteredData = filteredData.filter(item => item.date.startsWith(currentYear));
            } else if (period === 'custom' && startDate && endDate) {
                filteredData = filteredData.filter(item => item.date >= startDate && item.date <= endDate);
            }
            // 'all' এর জন্য কোন ফিল্টার প্রয়োগ করবে না
            
            return filteredData;
        }

        // স্টেটমেন্ট হেডার তৈরি
        function createStatementHeader(title) {
            return `
                <div class="print-section">
                    <div class="print-header">
                        <div class="logo">SA Traders</div>
                        <div class="tagline">বগুড়া - আপনার বিশ্বস্ত ব্যবসায়িক অংশীদার</div>
                        <div class="contact-info">
                            <div class="contact-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>বগুড়া, বাংলাদেশ</span>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-phone"></i>
                                <span>০১৭১৩-৬৪৫৮৮৩</span>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span>প্রিন্ট তারিখ: ${new Date().toLocaleDateString('bn-BD')}</span>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="text-align: center; color: #2a5298; margin-bottom: 20px; border-bottom: 2px solid #2a5298; padding-bottom: 10px;">${title}</h3>
            `;
        }

        // সময়কাল টেক্সট তৈরি
        function getPeriodText(period, startDate, endDate) {
            switch(period) {
                case 'daily':
                    return 'দৈনিক - ' + new Date().toLocaleDateString('bn-BD');
                case 'monthly':
                    return 'মাসিক - ' + new Date().toLocaleDateString('bn-BD', { month: 'long', year: 'numeric' });
                case 'yearly':
                    return 'বার্ষিক - ' + new Date().getFullYear();
                case 'custom':
                    return 'নির্দিষ্ট তারিখ - ' + startDate + ' থেকে ' + endDate;
                default:
                    return 'সমস্ত সময়';
            }
        }

        // স্টক রিপোর্ট প্রিন্ট
        document.getElementById('printStockBtn').addEventListener('click', function() {
            const data = dataManager.loadData();
            const products = data.products;
            
            let stockHTML = `
                <div class="print-section">
                    <div class="print-header">
                        <div class="logo">SA Traders</div>
                        <div class="tagline">বগুড়া - আপনার বিশ্বস্ত ব্যবসায়িক অংশীদার</div>
                        <div class="contact-info">
                            <div class="contact-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>বগুড়া, বাংলাদেশ</span>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-phone"></i>
                                <span>০১৭১৩-৬৪৫৮৮৩</span>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span>প্রিন্ট তারিখ: ${new Date().toLocaleDateString('bn-BD')}</span>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="text-align: center; color: #2a5298; margin-bottom: 20px; border-bottom: 2px solid #2a5298; padding-bottom: 10px;">পণ্য স্টক রিপোর্ট</h3>
                    
                    <table class="excel-table">
                        <thead>
                            <tr>
                                <th>পণ্য আইডি</th>
                                <th>পণ্যের নাম</th>
                                <th>ক্রয় মূল্য</th>
                                <th>বিক্রয় মূল্য</th>
                                <th>বর্তমান স্টক</th>
                                <th>স্টক স্ট্যাটাস</th>
                                <th>মোট ক্রয়</th>
                                <th>মোট বিক্রয়</th>
                                <th>স্টক মূল্য</th>
                                <th>ক্যাটাগরি</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            let totalProducts = 0;
            let totalStockQuantity = 0;
            let totalStockValue = 0;
            let lowStockProducts = 0;
            
            products.forEach(product => {
                const stockValue = product.stock * product.purchasePrice;
                const stockStatus = getStockStatus(product.stock);
                
                totalProducts++;
                totalStockQuantity += product.stock;
                totalStockValue += stockValue;
                
                if (product.stock <= 10) {
                    lowStockProducts++;
                }
                
                stockHTML += `
                    <tr>
                        <td>${product.id}</td>
                        <td>${product.name}</td>
                        <td>${formatNumber(product.purchasePrice)} টাকা</td>
                        <td>${formatNumber(product.sellingPrice || (product.purchasePrice * 1.2))} টাকা</td>
                        <td>${product.stock}</td>
                        <td>${stockStatus.text}</td>
                        <td>${product.totalPurchased || 0}</td>
                        <td>${product.totalSold || 0}</td>
                        <td>${formatNumber(stockValue)} টাকা</td>
                        <td>${product.category || '-'}</td>
                    </tr>
                `;
            });
            
            stockHTML += `
                        </tbody>
                    </table>
                    
                    <div class="summary-box" style="border: 2px solid #2a5298; background: linear-gradient(135deg, #f8f9fa, #e8f4f8); margin-top: 20px;">
                        <h4 style="text-align: center; margin-bottom: 15px; color: #2a5298; border-bottom: 1px solid #2a5298; padding-bottom: 5px;">স্টক সারাংশ</h4>
                        <div class="summary-item">
                            <span>মোট পণ্য:</span>
                            <span>${totalProducts} টি</span>
                        </div>
                        <div class="summary-item">
                            <span>মোট স্টক পরিমাণ:</span>
                            <span>${totalStockQuantity}</span>
                        </div>
                        <div class="summary-item">
                            <span>মোট স্টক মূল্য:</span>
                            <span>${formatNumber(totalStockValue)} টাকা</span>
                        </div>
                        <div class="summary-item">
                            <span>নিম্ন স্টক পণ্য:</span>
                            <span>${lowStockProducts} টি</span>
                        </div>
                    </div>
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>স্টক রিপোর্ট - SA Traders</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .excel-table { border-collapse: collapse; width: 100%; font-size: 12px; }
                        .excel-table th, .excel-table td { border: 1px solid #000; padding: 6px 8px; text-align: left; }
                        .excel-table th { background-color: #f2f2f2; font-weight: bold; }
                        .summary-box { border: 1px solid #000; padding: 10px; margin-top: 15px; background-color: #f9f9f9; }
                        .print-header { background: #1e3c72; color: white; padding: 20px; text-align: center; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    ${stockHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        });

        // স্টেটমেন্ট প্রিন্ট
        document.getElementById('printStatementBtn').addEventListener('click', function() {
            window.print();
        });

        // স্টেটমেন্ট তৈরি হলে প্রিন্ট বাটন দেখানো
        function showStatementActions() {
            document.getElementById('statementActions').style.display = 'flex';
        }

        // ============================================
        // ডেটা ম্যানেজমেন্ট ফাংশনালিটি
        // ============================================
        document.getElementById('saveDataBtn').addEventListener('click', function() {
            if (dataManager.exportData()) {
                alert('সমস্ত ডেটা সফলভাবে সেভ করা হয়েছে!');
            } else {
                alert('ডেটা সেভ করতে সমস্যা হয়েছে!');
            }
        });

        document.getElementById('loadDataBtn').addEventListener('click', function() {
            document.getElementById('fileInput').click();
        });

        document.getElementById('backupDataBtn').addEventListener('click', function() {
            if (dataManager.createBackup()) {
                alert('অটো ব্যাকআপ তৈরি করা হয়েছে!');
                updateDataStatus();
            } else {
                alert('ব্যাকআপ তৈরি করতে সমস্যা হয়েছে!');
            }
        });

        document.getElementById('restoreBackupBtn').addEventListener('click', function() {
            document.getElementById('backupFileInput').click();
        });

        document.getElementById('clearDataBtn').addEventListener('click', function() {
            if (confirm('আপনি কি সমস্ত ডেটা ক্লিয়ার করতে চান? এই কাজটি বিপরীতযোগ্য নয়!')) {
                if (dataManager.clearAllData()) {
                    alert('সমস্ত ডেটা ক্লিয়ার করা হয়েছে!');
                    initializeDashboard();
                } else {
                    alert('ডেটা ক্লিয়ার করতে সমস্যা হয়েছে!');
                }
            }
        });

        // ডেটা ইম্পোর্ট
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                if (confirm('আপনি কি নিশ্চিত যে আপনি এই ডেটা লোড করতে চান? বর্তমান ডেটা ওভাররাইট হয়ে যাবে!')) {
                    dataManager.importData(file)
                        .then(success => {
                            if (success) {
                                alert('ডেটা সফলভাবে লোড করা হয়েছে!');
                                initializeDashboard();
                            }
                        })
                        .catch(error => {
                            alert('ডেটা লোড করতে সমস্যা হয়েছে: ' + error.message);
                        });
                }
            }
            this.value = '';
        });

        // ব্যাকআপ থেকে রিস্টোর
        document.getElementById('backupFileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                if (confirm('আপনি কি ব্যাকআপ থেকে ডেটা রিস্টোর করতে চান? বর্তমান ডেটা হারিয়ে যাবে!')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            localStorage.setItem('saTradersBackup_v7', JSON.stringify(importedData));
                            if (dataManager.restoreFromBackup()) {
                                alert('ব্যাকআপ থেকে ডেটা সফলভাবে রিস্টোর করা হয়েছে!');
                                initializeDashboard();
                            }
                        } catch (error) {
                            alert('ব্যাকআপ থেকে রিস্টোর করতে সমস্যা হয়েছে: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            }
            this.value = '';
        });

        // ডেটা স্ট্যাটাস আপডেট
        function updateDataStatus() {
            const data = dataManager.loadData();
            const customers = data.customers;
            const products = data.products;
            const transactions = data.transactions;
            const purchases = data.purchases;
            const deposits = data.deposits || [];
            const backupExists = localStorage.getItem('saTradersBackup_v7') !== null;
            
            let statusHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <div style="padding: 8px; background: white; border-radius: 5px;">
                        <strong>ক্রেতা:</strong> ${customers.length} জন
                    </div>
                    <div style="padding: 8px; background: white; border-radius: 5px;">
                        <strong>পণ্য:</strong> ${products.length} টি
                    </div>
                    <div style="padding: 8px; background: white; border-radius: 5px;">
                        <strong>বিক্রয়:</strong> ${transactions.length} টি
                    </div>
                    <div style="padding: 8px; background: white; border-radius: 5px;">
                        <strong>ক্রয়:</strong> ${purchases.length} টি
                    </div>
                    <div style="padding: 8px; background: white; border-radius: 5px;">
                        <strong>জমা:</strong> ${deposits.length} টি
                    </div>
                    <div style="padding: 8px; background: white; border-radius: 5px;">
                        <strong>সর্বশেষ আপডেট:</strong> ${new Date(data.lastUpdated).toLocaleDateString('bn-BD')}
                    </div>
                </div>
                <div style="padding: 10px; background: ${backupExists ? '#d4edda' : '#fff3cd'}; border-radius: 5px; border: 1px solid ${backupExists ? '#c3e6cb' : '#ffeaa7'};">
                    <strong>ব্যাকআপ স্ট্যাটাস:</strong> ${backupExists ? 'ব্যাকআপ উপলব্ধ' : 'কোনো ব্যাকআপ নেই'}
                </div>
            `;
            
            document.getElementById('dataStatus').innerHTML = statusHTML;
        }

        // ম্যানুয়াল সেভ ফাংশন
        function manualSave() {
            const data = dataManager.loadData();
            if (data) {
                dataManager.createBackup();
                dataManager.updateAutoSaveStatus();
                alert('ডেটা সফলভাবে ম্যানুয়ালি সেভ করা হয়েছে!');
            }
        }

        // ============================================
        // ড্যাশবোর্ড ইনিশিয়ালাইজেশন
        // ============================================
        function initializeDashboard() {
            loadProducts();
            loadCustomers();
            loadTransactions();
            loadPurchases();
            loadDeposits();
            updateProductDropdown();
            loadCommissionRate();
            updateProfitLossSummary();
            updateDataStatus();
            updateRecentDeposits();
            updateAutocompleteLists();
            
            // তারিখ সেট করা
            setCurrentDate();
            
            // এডিটিং ডেটা চেক
            checkEditingData();
        }

        // এডিটিং ডেটা চেক এবং ফর্ম পূরণ
        function checkEditingData() {
            const editingProduct = dataManager.getEditingData('product');
            if (editingProduct) {
                editProduct(editingProduct.id);
            }
            
            const editingCustomer = dataManager.getEditingData('customer');
            if (editingCustomer) {
                editCustomer(editingCustomer.id);
            }
            
            const editingTransaction = dataManager.getEditingData('transaction');
            if (editingTransaction) {
                editTransaction(editingTransaction.id);
            }
            
            const editingPurchase = dataManager.getEditingData('purchase');
            if (editingPurchase) {
                editPurchase(editingPurchase.id);
            }
            
            const editingDeposit = dataManager.getEditingData('deposit');
            if (editingDeposit) {
                editDeposit(editingDeposit.id);
            }
        }

        // প্রথম লোডে ডেটা স্ট্যাটাস আপডেট
        window.addEventListener('load', function() {
            setTimeout(updateDataStatus, 1000);
        });

        // পিডিএফ এবং এক্সেল ডাউনলোড বাটন (প্লেসহোল্ডার)
        document.getElementById('downloadPDFBtn').addEventListener('click', function() {
            alert('PDF ডাউনলোড ফিচারটি সক্রিয় করতে jsPDF লাইব্রেরি যোগ করুন');
        });

        document.getElementById('downloadExcelBtn').addEventListener('click', function() {
            alert('এক্সেল ডাউনলোড ফিচারটি সক্রিয় করতে SheetJS লাইব্রেরি যোগ করুন');
        });

        document.getElementById('downloadStockBtn').addEventListener('click', function() {
            alert('স্টক ডাউনলোড ফিচারটি সক্রিয় করতে SheetJS লাইব্রেরি যোগ করুন');
        });
    </script>
</body>
</html>